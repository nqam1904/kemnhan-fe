import{m as K,J as W,K as Y,M as Z,r as p,j as e,d as U,I as g,B as o,Q as ee,c as x,O as te,H as se,f as ne}from"./index-CvJx62Zl.js";import{f as S}from"./format-number-DeezL_hy.js";import{e as ie}from"./index.es-JOJxY1ZJ.js";import{f as ae}from"./format-string-Cee-rHUc.js";import{u as le}from"./category-XjBXvEuM.js";import{b as re}from"./index-CaOnp5oM.js";import{c as ce}from"./styles-Bw6Lb06x.js";import{M as m}from"./Modal-DBHGt8c5.js";import{F as d}from"./Form-B0TxpSMS.js";import{o as oe,s as j,u as F,n as Q}from"./types-BvcOK83k.js";import"./useWillUnmount-CLlPHptt.js";import"./ElementChildren-Ce4dmsvR.js";const de=()=>{const{data:_=[],isLoading:B,refetch:b}=K(),{data:A=[]}=le(),[E]=W(),[I]=Y(),[D]=Z(),T={id:null,name:"",unit:"",description:"",displayPrice:0,sellPrice:0,stockQuantity:0,isFeature:!0,isActive:!0,shopeeUrl:"",categoryId:"",images:[]},[n,c]=p.useState(T),[H,f]=p.useState(!1),[L,$]=p.useState("Thêm sản phẩm"),[r,u]=p.useState({}),[P,k]=p.useState([]),N=p.useRef(0),[w,C]=p.useState({show:!1,id:null,label:""}),R=oe({name:j().min(1,"Vui lòng nhập tên sản phẩm!"),unit:j().min(1,"Vui lòng nhập đơn vị!"),categoryId:F([j(),Q()]).refine(t=>String(t).length>0,"Vui lòng chọn danh mục!"),sellPrice:F([j(),Q()]).refine(t=>String(t).length>0,"Vui lòng nhập giá tiền!"),stockQuantity:F([j(),Q()]).refine(t=>String(t).length>0,"Vui lòng nhập số lượng!"),description:j().min(1,"Vui lòng nhập mô tả!")}),M=()=>{c(T),k([]),u({}),N.current=0},V=t=>{var h,y;const s=Array.isArray(t==null?void 0:t.categoriesId)?t.categoriesId[0]:void 0,a=Array.isArray(t==null?void 0:t.categories)?(y=(h=t.categories)==null?void 0:h[0])==null?void 0:y.id:void 0,i=s??a??"";c({id:t.id,name:t.name||"",unit:t.unit||"",description:t.description||"",displayPrice:t.displayPrice||0,sellPrice:S(t.sellPrice||0),stockQuantity:String(t.stockQuantity||0),isFeature:!!t.isFeature,isActive:!!t.isActive,shopeeUrl:t.shopeeUrl||"",categoryId:i,images:[]});const l=Array.isArray(t==null?void 0:t.images)?t.images.map(v=>v!=null&&v.key?String(v.key):null).filter(Boolean).map(v=>U(`${v}`)):[];k(l),N.current=l.length,$("Cập nhật sản phẩm"),f(!0)},G=t=>{const s=t.name||`#${t.id}`;C({show:!0,id:t.id,label:s})},O=async t=>{try{await D({id:t}).unwrap(),x.success("Xóa thành công"),b()}catch{x.error("Có lỗi xảy ra")}},X=async t=>{try{await I({id:t.id,body:{isFeature:!t.isFeature}}).unwrap(),x.success("Cập nhật thành công"),b()}catch(s){console.log(s)}},z=async t=>{try{await I({id:t.id,body:{isActive:!t.isActive}}).unwrap(),x.success("Cập nhật thành công"),b()}catch(s){console.log(s)}},q=async t=>{var a;t.preventDefault();const s=R.safeParse({name:n.name,unit:n.unit,categoryId:n.categoryId,sellPrice:n.sellPrice,stockQuantity:n.stockQuantity,description:n.description});if(!s.success){const i={};s.error.issues.forEach(l=>{const h=l.path[0];h&&!i[h]&&(i[h]=l.message)}),u(i);return}u({});try{if(n.id)await I({id:n.id,body:{name:n.name,unit:n.unit,description:n.description,displayPrice:parseInt(String(n.displayPrice||0).replace(/[^\d]/g,""),10),sellPrice:parseInt(String(n.sellPrice||0).replace(/[^\d]/g,""),10),stockQuantity:parseInt(String(n.stockQuantity||0).replace(/[^\d]/g,""),10),isFeature:n.isFeature,isActive:n.isActive,shopeeUrl:n.shopeeUrl,categoriesId:[parseInt(String(n.categoryId),10)]}}).unwrap(),x.success("Cập nhật thành công!");else{const i=new FormData;n.images&&n.images.length>0&&n.images.forEach(y=>i.append("medias",y));const l=await te.post("media",i,{headers:{"Content-Type":"multipart/form-data"}}),h=((a=l==null?void 0:l.data)==null?void 0:a.mediasId)||[];await E({body:{name:n.name,unit:n.unit,description:n.description,displayPrice:parseInt(String(n.displayPrice||0).replace(/[^\d]/g,""),10),sellPrice:parseInt(String(n.sellPrice||0).replace(/[^\d]/g,""),10),stockQuantity:parseInt(String(n.stockQuantity||0).replace(/[^\d]/g,""),10),isFeature:n.isFeature,isActive:n.isActive,shopeeUrl:n.shopeeUrl,categoriesId:[parseInt(String(n.categoryId),10)],imagesId:h}}).unwrap(),x.success("Thêm thành công!")}f(!1),M(),b()}catch{x.error("Có lỗi xảy ra")}},J=p.useMemo(()=>[{name:"#",selector:"id",sortable:!0},{name:"Tên sản phẩm",selector:"name",sortable:!0},{name:"Hình ảnh",selector:t=>{var s,a;return((a=(s=t.images)==null?void 0:s[0])==null?void 0:a.key)||""},cell:t=>{var i,l;const s=(l=(i=t.images)==null?void 0:i[0])==null?void 0:l.key,a=s?U(`${s}`):g.logo;return e.jsx("div",{style:{padding:8},children:e.jsx(re.LazyLoadImage,{src:a,alt:t.name,width:80,height:80,effect:"blur",placeholderSrc:g.logo,style:{objectFit:"cover",borderRadius:4}})})}},{name:"Giá tiền",selector:"sellPrice",cell:t=>e.jsxs("span",{children:[S(t.sellPrice)," VNĐ"]})},{name:"Đã bán",selector:"soldQuantity"},{name:"Đơn vị",selector:"unit"},{name:"Số lượng",selector:"stockQuantity"},{name:"Mô tả",selector:"description",cell:t=>e.jsx("div",{style:{maxWidth:400,overflow:"hidden"},children:ae(t.description||"")})},{name:"Nổi bật",selector:"isFeature",cell:t=>e.jsx(o,{variant:"link",className:"p-0",onClick:()=>X(t),children:e.jsx("img",{src:t.isFeature?g.icEye:g.icNoEye,alt:"feature",width:25})})},{name:"Hiển thị",selector:"isActive",cell:t=>e.jsx(o,{variant:"link",className:"p-0",onClick:()=>z(t),children:e.jsx("img",{src:t.isActive?g.icEye:g.icNoEye,alt:"active",width:25})})},{name:"Chức năng",selector:t=>t.id,cell:t=>e.jsxs(e.Fragment,{children:[e.jsx(o,{type:"button",className:"btn btn-warning white mr-10",onClick:()=>V(t),children:"Sửa"}),e.jsx(o,{type:"button",className:"btn btn-danger white",onClick:()=>G(t),children:"Xoá"})]})}],[]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between mt-10 mbt-10",children:[e.jsx("h1",{className:"m-0",children:"Danh sách sản phẩm"}),e.jsxs("div",{children:[e.jsx(o,{type:"button",className:"btn btn-primary",onClick:()=>{f(!0),$("Thêm sản phẩm"),M()},children:"Thêm sản phẩm"}),e.jsx(o,{variant:"success",className:"ml-10",type:"button",onClick:()=>{window.open("https://kemnhanonline.vn/api/products/export","_blank")},children:"Xuất Excel"})]})]}),e.jsx(ee,{autoClose:1e3}),e.jsx(ie,{title:"",columns:J,data:_,defaultSortFieldId:"title",pagination:!0,progressPending:B,responsive:!0,dense:!0,customStyles:ce}),e.jsx(m,{size:"lg","aria-labelledby":"contained-modal-title-vcenter",centered:!0,show:H,onHide:()=>{f(!1)},animation:!1,backdrop:"static",children:e.jsxs(d,{onSubmit:q,noValidate:!0,children:[e.jsx(m.Header,{closeButton:!0,children:e.jsx(m.Title,{children:L.toString()})}),e.jsxs(m.Body,{className:"product-form",children:[e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:" form-group col-6",children:[e.jsxs("label",{children:["Danh Mục ",e.jsx("sup",{className:"sub_text",children:"*"})]}),e.jsxs(d.Control,{as:"select",className:`form-control ${r.categoryId?"is-invalid":""}`,value:String(n.categoryId),onChange:t=>{c(s=>({...s,categoryId:t.target.value})),u(s=>({...s,categoryId:void 0}))},children:[e.jsx("option",{value:"",children:"Thêm danh mục"}),A&&A.map((t,s)=>e.jsx("option",{value:t.id,children:t.name},s))]}),e.jsx("div",{className:`invalid-feedback ${r.categoryId?"d-block":""}`,children:r.categoryId})]}),e.jsxs("div",{className:" form-group col-6",children:[e.jsxs("label",{children:["Tên sản phẩm ",e.jsx("sup",{className:"sub_text",children:"*"})]}),e.jsx(d.Control,{className:`form-control ${r.name?"is-invalid":""}`,name:"name",value:n.name,placeholder:"Nhập tên sản phẩm",onChange:t=>{c(s=>({...s,name:t.target.value})),u(s=>({...s,name:void 0}))}}),e.jsx("div",{className:`invalid-feedback ${r.name?"d-block":""}`,children:r.name})]})]}),e.jsxs(d.Group,{controlId:"product-images",children:[e.jsx(d.Label,{children:"Hình ảnh (hình đầu tiên sẽ là mặc định)"}),e.jsx(d.Control,{type:"file",multiple:!0,onChange:t=>{const s=t.target.files,a=s?Array.from(s):[];if(!a.length)return;c(l=>({...l,images:[...l.images,...a]}));const i=a.map(l=>URL.createObjectURL(l));k(l=>[...l,...i])}})]}),P&&P.length>0?e.jsx("div",{className:"mbt-10 show_image",children:e.jsx("div",{className:"container testimonial-group",children:e.jsx("div",{className:"row text-center",children:e.jsx("div",{className:"col-xs-4",children:P.map((t,s)=>e.jsxs("div",{style:{position:"relative",display:"inline-block",marginRight:8,marginBottom:8},children:[e.jsx("img",{src:t,width:"100",height:"auto",alt:"preview"}),e.jsx(o,{variant:"link",className:"p-0","aria-label":"Remove image",onClick:()=>{try{URL.revokeObjectURL(t)}catch(a){console.log(a)}k(a=>a.filter((i,l)=>l!==s)),c(a=>{const i=N.current;if(s<i)return N.current=Math.max(0,i-1),a;const l=s-i;return{...a,images:a.images.filter((h,y)=>y!==l)}})},style:{position:"absolute",top:-6,right:-6,border:"none",background:"transparent",padding:0,cursor:"pointer"},children:e.jsx("img",{src:g.ic_clear,alt:"clear",width:18,height:18})})]},`${t}-${s}`))})})})}):e.jsx("div",{style:{marginBottom:10}}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:" form-group col-6",children:[e.jsxs("label",{children:["Tiền ",e.jsx("sup",{className:"sub_text",children:"*"})]}),e.jsx(d.Control,{className:`form-control ${r.sellPrice?"is-invalid":""}`,type:"text",name:"sellPrice",placeholder:"Nhập giá tiền sản phẩm",value:String(n.sellPrice),onChange:t=>{const s=t.target.value.replace(/[^\d]/g,""),a=S(s);c(i=>({...i,sellPrice:a})),u(i=>({...i,sellPrice:void 0}))}}),e.jsx("div",{className:`invalid-feedback ${r.sellPrice?"d-block":""}`,children:r.sellPrice})]}),e.jsxs("div",{className:"form-group col-6",children:[e.jsxs("label",{children:["Đơn vị ",e.jsx("sup",{className:"sub_text",children:"*"})]}),e.jsx(d.Control,{className:`form-control ${r.unit?"is-invalid":""}`,name:"unit",placeholder:"Ví du: Hộp, Cái,...",value:n.unit,onChange:t=>{c(s=>({...s,unit:t.target.value})),u(s=>({...s,unit:void 0}))}}),e.jsx("div",{className:`invalid-feedback ${r.unit?"d-block":""}`,children:r.unit})]})]}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:" form-group col-6",children:[e.jsxs("label",{children:["Số lượng ",e.jsx("sup",{className:"sub_text",children:"*"})]}),e.jsx(d.Control,{className:`form-control ${r.stockQuantity?"is-invalid":""}`,type:"text",name:"stockQuantity",placeholder:"Nhập số lượng sản phẩm",value:String(n.stockQuantity),onChange:t=>{const s=t.target.value.replace(/[^\d]/g,""),a=Math.min(parseInt(s||"0",10),1e3);c(i=>({...i,stockQuantity:String(a)})),u(i=>({...i,stockQuantity:void 0}))}}),e.jsx("div",{className:`invalid-feedback ${r.stockQuantity?"d-block":""}`,children:r.stockQuantity})]}),e.jsxs("div",{className:" form-group col-6",children:[e.jsx("label",{children:" Link Shoppe (Nếu có)"}),e.jsx(d.Control,{className:"form-control",name:"shopeeUrl",placeholder:"Nhập link shoppee nếu có",value:n.shopeeUrl,onChange:t=>{c(s=>({...s,shopeeUrl:t.target.value}))}})]})]}),e.jsx("label",{children:" Mô tả "}),e.jsx(d.Control,{as:"textarea",rows:6,className:`form-control ${r.description?"is-invalid":""}`,placeholder:"Nhập mô tả sản phẩm",name:"description",value:n.description,onChange:t=>{c(s=>({...s,description:t.target.value})),u(s=>({...s,description:void 0}))}}),e.jsx("div",{className:`invalid-feedback ${r.description?"d-block":""}`,children:r.description})]}),e.jsxs(m.Footer,{children:[e.jsx(o,{variant:"secondary",type:"button",onClick:()=>{f(!1)},children:"Đóng"}),e.jsx(o,{type:"submit",children:"Lưu"})]})]})}),e.jsxs(m,{show:w.show,onHide:()=>C({show:!1,id:null,label:""}),centered:!0,animation:!1,backdrop:"static",children:[e.jsx(m.Header,{closeButton:!0,children:e.jsx(m.Title,{children:"Xác nhận xoá"})}),e.jsxs(m.Body,{children:['Bạn có chắc muốn xoá sản phẩm "',w.label,'" không?']}),e.jsxs(m.Footer,{children:[e.jsx(o,{variant:"secondary",type:"button",onClick:()=>C({show:!1,id:null,label:""}),children:"Huỷ"}),e.jsx(o,{variant:"danger",type:"button",onClick:async()=>{w.id&&(await O(w.id),C({show:!1,id:null,label:""}))},children:"Xoá"})]})]})]})},me={title:`Sản phẩm - ${ne.appName}`};function we(){return e.jsxs(e.Fragment,{children:[e.jsx(se,{children:e.jsxs("title",{children:[" ",me.title]})}),e.jsx(de,{})]})}export{we as default};
