import{r as p,j as e,z as K,s as o,Q as Y,X as Z,M as m,F as d,v as g,w as ee}from"./vendor-react-D439mYZB.js";import{f as te,a as se,k as ae,l as ie,m as ne,r as R,I as x,n as U,C as re}from"./index-CCO37Pg2.js";import{f as P}from"./format-number-D7I21mwK.js";import{f as le}from"./format-string-Cee-rHUc.js";import{u as ce}from"./category-2T4LDmHX.js";import{c as oe}from"./styles-Bw6Lb06x.js";import{ao as de,ap as y,aq as S,as as F}from"./vendor-misc-BkUckcGj.js";import"./vendor-redux-CY9rYXZh.js";import"./vendor-ui-qtF25uBn.js";import"./vendor-utils-DifT8CeW.js";const me=()=>{const{data:M=[],isLoading:E,refetch:j}=te(),_=se(),{data:Q=[]}=ce(),[D]=ae(),[w]=ie(),[B]=ne(),A={id:null,name:"",unit:"",description:"",displayPrice:0,sellPrice:0,stockQuantity:0,isFeature:!0,isActive:!0,shopeeUrl:"",categoryId:"",images:[]},[a,c]=p.useState(A),[L,v]=p.useState(!1),[H,T]=p.useState("Thêm sản phẩm"),[l,u]=p.useState({}),[C,f]=p.useState([]),b=p.useRef(0),[k,N]=p.useState({show:!1,id:null,label:""}),V=de({name:y().min(1,"Vui lòng nhập tên sản phẩm!"),unit:y().min(1,"Vui lòng nhập đơn vị!"),categoryId:S([y(),F()]).refine(t=>String(t).length>0,"Vui lòng chọn danh mục!"),sellPrice:S([y(),F()]).refine(t=>String(t).length>0,"Vui lòng nhập giá tiền!"),stockQuantity:S([y(),F()]).refine(t=>String(t).length>0,"Vui lòng nhập số lượng!"),description:y().min(1,"Vui lòng nhập mô tả!")}),$=()=>{c(A),f([]),u({}),b.current=0},X=t=>{const s=Array.isArray(t?.categoriesId)?t.categoriesId[0]:void 0,i=Array.isArray(t?.categories)?t.categories?.[0]?.id:void 0,n=s??i??"";c({id:t.id,name:t.name||"",unit:t.unit||"",description:t.description||"",displayPrice:t.displayPrice||0,sellPrice:P(t.sellPrice||0),stockQuantity:String(t.stockQuantity||0),isFeature:!!t.isFeature,isActive:!!t.isActive,shopeeUrl:t.shopeeUrl||"",categoryId:n,images:[]});const r=Array.isArray(t?.images)?t.images.map(h=>h?.key?String(h.key):null).filter(Boolean).map(h=>R(`${h}`)):[];f(r),b.current=r.length,T("Cập nhật sản phẩm"),v(!0)},G=t=>{const s=t.name||`#${t.id}`;N({show:!0,id:t.id,label:s})},O=async t=>{try{await B({id:t}).unwrap(),g.success("Xóa thành công"),j()}catch{g.error("Có lỗi xảy ra")}},z=async t=>{try{await w({id:t.id,body:{isFeature:!t.isFeature}}).unwrap(),g.success("Cập nhật thành công"),j()}catch{}},q=async t=>{try{await w({id:t.id,body:{isActive:!t.isActive}}).unwrap(),g.success("Cập nhật thành công"),j()}catch{}},W=async t=>{t.preventDefault();const s=V.safeParse({name:a.name,unit:a.unit,categoryId:a.categoryId,sellPrice:a.sellPrice,stockQuantity:a.stockQuantity,description:a.description});if(!s.success){const i={};s.error.issues.forEach(n=>{const r=n.path[0];r&&!i[r]&&(i[r]=n.message)}),u(i);return}u({});try{if(a.id){let i=[];if(a.images&&a.images.length>0){const r=new FormData;a.images.forEach(I=>r.append("medias",I)),i=(await U.post("media",r,{headers:{"Content-Type":"multipart/form-data"}}))?.data?.mediasId||[]}const n={name:a.name,unit:a.unit,description:a.description,displayPrice:parseInt(String(a.displayPrice||0).replace(/[^\d]/g,""),10),sellPrice:parseInt(String(a.sellPrice||0).replace(/[^\d]/g,""),10),stockQuantity:parseInt(String(a.stockQuantity||0).replace(/[^\d]/g,""),10),isFeature:a.isFeature,isActive:a.isActive,shopeeUrl:a.shopeeUrl,categoriesId:[parseInt(String(a.categoryId),10)]};i.length>0&&(n.imagesId=i),await w({id:a.id,body:n}).unwrap(),g.success("Cập nhật thành công!")}else{const i=new FormData;a.images&&a.images.length>0&&a.images.forEach(h=>i.append("medias",h));const r=(await U.post("media",i,{headers:{"Content-Type":"multipart/form-data"}}))?.data?.mediasId||[];await D({body:{name:a.name,unit:a.unit,description:a.description,displayPrice:parseInt(String(a.displayPrice||0).replace(/[^\d]/g,""),10),sellPrice:parseInt(String(a.sellPrice||0).replace(/[^\d]/g,""),10),stockQuantity:parseInt(String(a.stockQuantity||0).replace(/[^\d]/g,""),10),isFeature:a.isFeature,isActive:a.isActive,shopeeUrl:a.shopeeUrl,categoriesId:[parseInt(String(a.categoryId),10)],imagesId:r}}).unwrap(),g.success("Thêm thành công!")}v(!1),$(),j()}catch{g.error("Có lỗi xảy ra")}},J=p.useMemo(()=>[{name:"#",selector:"id",sortable:!0},{name:"Tên sản phẩm",selector:"name",sortable:!0},{name:"Hình ảnh",selector:t=>t.images?.[0]?.key||"",cell:t=>{const s=t.images?.[0]?.key,i=s?R(`${s}`):x.logo;return e.jsx("div",{style:{padding:8},children:e.jsx(K.LazyLoadImage,{src:i,alt:t.name,width:80,height:80,effect:"blur",placeholderSrc:x.logo,style:{objectFit:"cover",borderRadius:4}})})}},{name:"Giá tiền",selector:"sellPrice",cell:t=>e.jsxs("span",{children:[P(t.sellPrice)," VNĐ"]})},{name:"Đã bán",selector:"soldQuantity"},{name:"Đơn vị",selector:"unit"},{name:"Số lượng",selector:"stockQuantity"},{name:"Mô tả",selector:"description",cell:t=>e.jsx("div",{style:{maxWidth:400,overflow:"hidden"},children:le(t.description||"")})},{name:"Nổi bật",selector:"isFeature",cell:t=>e.jsx(o,{variant:"link",className:"p-0",onClick:()=>z(t),children:e.jsx("img",{src:t.isFeature?x.icEye:x.icNoEye,alt:"feature",width:25})})},{name:"Hiển thị",selector:"isActive",cell:t=>e.jsx(o,{variant:"link",className:"p-0",onClick:()=>q(t),children:e.jsx("img",{src:t.isActive?x.icEye:x.icNoEye,alt:"active",width:25})})},{name:"Chức năng",selector:t=>t.id,cell:t=>e.jsxs(e.Fragment,{children:[e.jsx(o,{type:"button",className:"btn btn-warning white mr-10",onClick:()=>X(t),children:"Sửa"}),e.jsx(o,{type:"button",className:"btn btn-danger white",onClick:()=>G(t),children:"Xoá"})]})}],[]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between mt-10 mbt-10",children:[e.jsx("h1",{className:"m-0",children:"Danh sách sản phẩm"}),e.jsxs("div",{children:[e.jsx(o,{type:"button",className:"btn btn-primary",onClick:()=>{v(!0),T("Thêm sản phẩm"),$()},children:"Thêm sản phẩm"}),e.jsx(o,{variant:"success",className:"ml-10",type:"button",onClick:()=>{_.push("https://kemnhanonline.vn/api/products/export")},children:"Xuất Excel"})]})]}),e.jsx(Y,{autoClose:1e3}),e.jsx(Z,{title:"",columns:J,data:M,defaultSortFieldId:"title",pagination:!0,progressPending:E,responsive:!0,dense:!0,customStyles:oe}),e.jsx(m,{size:"lg","aria-labelledby":"contained-modal-title-vcenter",centered:!0,show:L,onHide:()=>{v(!1)},animation:!1,backdrop:"static",children:e.jsxs(d,{onSubmit:W,noValidate:!0,children:[e.jsx(m.Header,{closeButton:!0,children:e.jsx(m.Title,{children:H.toString()})}),e.jsxs(m.Body,{className:"product-form",children:[e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:" form-group col-6",children:[e.jsxs("label",{children:["Danh Mục ",e.jsx("sup",{className:"sub_text",children:"*"})]}),e.jsxs(d.Control,{as:"select",className:`form-control ${l.categoryId?"is-invalid":""}`,value:String(a.categoryId),onChange:t=>{c(s=>({...s,categoryId:t.target.value})),u(s=>({...s,categoryId:void 0}))},children:[e.jsx("option",{value:"",children:"Thêm danh mục"}),Q&&Q.map((t,s)=>e.jsx("option",{value:t.id,children:t.name},s))]}),e.jsx("div",{className:`invalid-feedback ${l.categoryId?"d-block":""}`,children:l.categoryId})]}),e.jsxs("div",{className:" form-group col-6",children:[e.jsxs("label",{children:["Tên sản phẩm ",e.jsx("sup",{className:"sub_text",children:"*"})]}),e.jsx(d.Control,{className:`form-control ${l.name?"is-invalid":""}`,name:"name",value:a.name,placeholder:"Nhập tên sản phẩm",onChange:t=>{c(s=>({...s,name:t.target.value})),u(s=>({...s,name:void 0}))}}),e.jsx("div",{className:`invalid-feedback ${l.name?"d-block":""}`,children:l.name})]})]}),e.jsxs(d.Group,{controlId:"product-images",children:[e.jsx(d.Label,{children:"Hình ảnh (hình đầu tiên sẽ là mặc định)"}),e.jsx(d.Control,{type:"file",multiple:!0,onChange:t=>{const s=t.target.files,i=s?Array.from(s):[];if(!i.length)return;c(r=>({...r,images:[...r.images,...i]}));const n=i.map(r=>URL.createObjectURL(r));f(r=>[...r,...n])}})]}),C&&C.length>0?e.jsx("div",{className:"mbt-10 show_image",children:e.jsx("div",{className:"container testimonial-group",children:e.jsx("div",{className:"row text-center",children:e.jsx("div",{className:"col-xs-4",children:C.map((t,s)=>e.jsxs("div",{style:{position:"relative",display:"inline-block",marginRight:8,marginBottom:8},children:[e.jsx("img",{src:t,width:"100",height:"auto",alt:"preview"}),e.jsx(o,{variant:"link",className:"p-0","aria-label":"Remove image",onClick:()=>{try{URL.revokeObjectURL(t)}catch{}f(i=>i.filter((n,r)=>r!==s)),c(i=>{const n=b.current;if(s<n)return b.current=Math.max(0,n-1),i;const r=s-n;return{...i,images:i.images.filter((h,I)=>I!==r)}})},style:{position:"absolute",top:-6,right:-6,border:"none",background:"transparent",padding:0,cursor:"pointer"},children:e.jsx("img",{src:x.ic_clear,alt:"clear",width:18,height:18})})]},`${t}-${s}`))})})})}):e.jsx("div",{style:{marginBottom:10}}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:" form-group col-6",children:[e.jsxs("label",{children:["Tiền ",e.jsx("sup",{className:"sub_text",children:"*"})]}),e.jsx(d.Control,{className:`form-control ${l.sellPrice?"is-invalid":""}`,type:"text",name:"sellPrice",placeholder:"Nhập giá tiền sản phẩm",value:String(a.sellPrice),onChange:t=>{const s=t.target.value.replace(/[^\d]/g,""),i=P(s);c(n=>({...n,sellPrice:i})),u(n=>({...n,sellPrice:void 0}))}}),e.jsx("div",{className:`invalid-feedback ${l.sellPrice?"d-block":""}`,children:l.sellPrice})]}),e.jsxs("div",{className:"form-group col-6",children:[e.jsxs("label",{children:["Đơn vị ",e.jsx("sup",{className:"sub_text",children:"*"})]}),e.jsx(d.Control,{className:`form-control ${l.unit?"is-invalid":""}`,name:"unit",placeholder:"Ví du: Hộp, Cái,...",value:a.unit,onChange:t=>{c(s=>({...s,unit:t.target.value})),u(s=>({...s,unit:void 0}))}}),e.jsx("div",{className:`invalid-feedback ${l.unit?"d-block":""}`,children:l.unit})]})]}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:" form-group col-6",children:[e.jsxs("label",{children:["Số lượng ",e.jsx("sup",{className:"sub_text",children:"*"})]}),e.jsx(d.Control,{className:`form-control ${l.stockQuantity?"is-invalid":""}`,type:"text",name:"stockQuantity",placeholder:"Nhập số lượng sản phẩm",value:String(a.stockQuantity),onChange:t=>{const s=t.target.value.replace(/[^\d]/g,""),i=Math.min(parseInt(s||"0",10),1e3);c(n=>({...n,stockQuantity:String(i)})),u(n=>({...n,stockQuantity:void 0}))}}),e.jsx("div",{className:`invalid-feedback ${l.stockQuantity?"d-block":""}`,children:l.stockQuantity})]}),e.jsxs("div",{className:" form-group col-6",children:[e.jsx("label",{children:" Link Shoppe (Nếu có)"}),e.jsx(d.Control,{className:"form-control",name:"shopeeUrl",placeholder:"Nhập link shoppee nếu có",value:a.shopeeUrl,onChange:t=>{c(s=>({...s,shopeeUrl:t.target.value}))}})]})]}),e.jsx("label",{children:" Mô tả "}),e.jsx(d.Control,{as:"textarea",rows:6,className:`form-control ${l.description?"is-invalid":""}`,placeholder:"Nhập mô tả sản phẩm",name:"description",value:a.description,onChange:t=>{c(s=>({...s,description:t.target.value})),u(s=>({...s,description:void 0}))}}),e.jsx("div",{className:`invalid-feedback ${l.description?"d-block":""}`,children:l.description})]}),e.jsxs(m.Footer,{children:[e.jsx(o,{variant:"secondary",type:"button",onClick:()=>{v(!1)},children:"Đóng"}),e.jsx(o,{type:"submit",children:"Lưu"})]})]})}),e.jsxs(m,{show:k.show,onHide:()=>N({show:!1,id:null,label:""}),centered:!0,animation:!1,backdrop:"static",children:[e.jsx(m.Header,{closeButton:!0,children:e.jsx(m.Title,{children:"Xác nhận xoá"})}),e.jsxs(m.Body,{children:['Bạn có chắc muốn xoá sản phẩm "',k.label,'" không?']}),e.jsxs(m.Footer,{children:[e.jsx(o,{variant:"secondary",type:"button",onClick:()=>N({show:!1,id:null,label:""}),children:"Huỷ"}),e.jsx(o,{variant:"danger",type:"button",onClick:async()=>{k.id&&(await O(k.id),N({show:!1,id:null,label:""}))},children:"Xoá"})]})]})]})},ue={title:`Sản phẩm - ${re.appName}`};function Ne(){return e.jsxs(e.Fragment,{children:[e.jsx(ee,{children:e.jsxs("title",{children:[" ",ue.title]})}),e.jsx(me,{})]})}export{Ne as default};
