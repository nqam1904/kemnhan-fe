import{j as t,r as A,I as y,B as l,Q as U,c as d,H as X,d as G}from"./index-CGSQnQu3.js";import{f as D}from"./format-time-Di1EMY9f.js";import{e as V}from"./index.es-BVU3MIBu.js";import{f as Q}from"./format-string-Cee-rHUc.js";import{r as c}from"./vendor-D10guwLI.js";import{c as q}from"./styles-Bw6Lb06x.js";import{u as z,b as K,c as W,d as J}from"./promotions-CNuytV84.js";import{M as o}from"./Modal-uUVsHhbb.js";import{F as h}from"./Form-DYuaszbI.js";import{o as Z,s as ee}from"./types-BvcOK83k.js";import"./dayjs.min-DmYrFLVn.js";import"./ElementChildren-DQADstU7.js";const te=()=>{const{data:M=[],isLoading:T,refetch:b}=z(),[F]=K(),[k]=W(),[H]=J(),N={id:null,name:"",content:"",endDate:new Date().toISOString(),isActive:!1,images:[]},[s,m]=c.useState(N),[P,u]=c.useState(!1),[B,C]=c.useState("Thêm tin khuyến mãi"),[p,g]=c.useState({show:!1,id:null,label:""}),[v,x]=c.useState([]),f=c.useRef(0),[w,j]=c.useState({}),I=Z({name:ee().min(1,"Vui lòng điền tiêu đề!")}),S=()=>{m(N),x([]),j({}),f.current=0},Y=e=>{m({id:e.id,name:e.name||"",content:e.content||"",endDate:e.endDate||new Date().toISOString(),isActive:!!e.isActive,images:[]});const a=Array.isArray(e==null?void 0:e.images)?e.images.map(n=>n!=null&&n.key?String(n.key):null).filter(Boolean).map(n=>A(`${n}`)):[];x(a),f.current=a.length,C("Cập nhật tin khuyến mãi"),u(!0)},L=e=>{const a=e.name||`#${e.id}`;g({show:!0,id:e.id,label:a})},R=async e=>{try{await k({id:e.id,body:{isActive:!e.isActive}}).unwrap(),d.success("Cập nhật thành công"),b()}catch{}},E=async e=>{try{await H({id:e}).unwrap(),d.success("Xóa thành công"),b()}catch{d.error("Có lỗi xảy ra")}},_=async e=>{e.preventDefault();const a=I.safeParse({name:s.name});if(!a.success){const n={};a.error.issues.forEach(r=>{const i=r.path[0];i&&!n[i]&&(n[i]=r.message)}),j(n);return}j({});try{if(s.id)await k({id:s.id,body:{name:s.name,content:s.content,slug:s.name,endDate:s.endDate||new Date().toISOString()}}).unwrap(),d.success("Cập nhật thành công!");else{const n=new FormData;n.append("name",s.name),n.append("content",s.content),n.append("endDate",s.endDate),n.append("isActive",String(s.isActive)),n.append("slug",s.name),s.images&&s.images.length>0&&s.images.forEach(r=>n.append("images",r)),await F({body:n}).unwrap(),d.success("Thêm thành công!")}u(!1),S(),b()}catch{d.error("Có lỗi xảy ra")}},$=c.useMemo(()=>[{name:"#",selector:"id",sortable:!0},{name:"Tiêu đề",selector:"name",sortable:!0},{name:"Hình ảnh",selector:e=>{var a,n;return((n=(a=e.images)==null?void 0:a[0])==null?void 0:n.key)||""},cell:e=>{var r,i;const a=(i=(r=e.images)==null?void 0:r[0])==null?void 0:i.key,n=a?A(`${a}`):y.logo;return t.jsx("img",{src:n,alt:e.name,width:80,height:"auto"})}},{name:"Nội dung",selector:"content",grow:3,cell:e=>t.jsx("div",{style:{maxWidth:400,overflow:"hidden"},dangerouslySetInnerHTML:{__html:Q(e.content||"")}})},{name:"Ngày tạo",selector:e=>e.createDate||e.createdAt||"",sortable:!0,right:!0,cell:e=>t.jsx("span",{children:D(e.createDate||e.createdAt,"DD/MM/YYYY")})},{name:"Ngày cập nhật",selector:e=>e.writeDate||e.updatedAt||"",sortable:!0,right:!0,cell:e=>t.jsx("span",{children:D(e.writeDate||e.updatedAt,"DD/MM/YYYY")})},{name:"Ngày kết thúc",selector:e=>e.endDate||"",sortable:!0,right:!0,cell:e=>t.jsx("span",{children:D(e.endDate,"DD/MM/YYYY")})},{name:"Hiển thị",selector:"isActive",right:!0,cell:e=>t.jsx(l,{variant:"link",className:"p-0",onClick:()=>R(e),"aria-label":e.isActive?"Ẩn":"Hiện",children:t.jsx("img",{src:e.isActive?y.icEye:y.icNoEye,alt:e.isActive?"active":"inactive",width:25})})},{name:"Chức năng",selector:e=>e.id,cell:e=>t.jsxs(t.Fragment,{children:[t.jsx(l,{type:"button",className:"btn btn-warning white mr-10",onClick:()=>Y(e),children:"Sửa"}),t.jsx(l,{type:"button",className:"btn btn-danger white",onClick:()=>L(e),children:"Xoá"})]})}],[]);return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"d-flex align-items-center justify-content-between mt-10 mbt-10",children:[t.jsx("h1",{className:"m-0",children:"Tin Khuyến mãi"}),t.jsx("div",{children:t.jsx(l,{type:"button",className:"btn btn-primary",onClick:()=>{u(!0),C("Thêm tin khuyến mãi"),S()},children:"Thêm khuyến mãi"})})]}),t.jsx(U,{autoClose:1e3}),t.jsx(V,{title:"",columns:$,data:M,defaultSortFieldId:"title",pagination:!0,progressPending:T,responsive:!0,dense:!0,customStyles:q}),t.jsx(o,{size:"lg","aria-labelledby":"contained-modal-title-vcenter",centered:!0,show:P,onHide:()=>{u(!1)},animation:!1,backdrop:"static",children:t.jsxs(h,{onSubmit:_,noValidate:!0,children:[t.jsx(o.Header,{closeButton:!0,children:t.jsxs(o.Title,{children:[" ",B]})}),t.jsxs(o.Body,{className:"news-form",children:[t.jsxs("div",{className:"form-group",children:[t.jsx("label",{children:"Tiêu đề"}),t.jsx(h.Control,{className:`form-control ${w.name?"is-invalid":""}`,value:s.name,name:"name",placeholder:"Nhập tiêu đề",onChange:e=>{m(a=>({...a,name:e.target.value})),j(a=>({...a,name:void 0}))}}),t.jsx("div",{className:`invalid-feedback ${w.name?"d-block":""}`,children:w.name})]}),t.jsxs(h.Group,{controlId:"promotion-images",className:"form-group",children:[t.jsx(h.Label,{children:"Hình ảnh (hình đầu tiên sẽ là mặc định)"}),t.jsx(h.Control,{type:"file",multiple:!0,onChange:e=>{const a=e.target.files,n=a?Array.from(a):[];if(!n.length)return;m(i=>({...i,images:[...i.images,...n]}));const r=n.map(i=>URL.createObjectURL(i));x(i=>[...i,...r])}})]}),v&&v.length>0?t.jsx("div",{className:"mbt-10 show_image",children:t.jsx("div",{className:"container testimonial-group",children:t.jsx("div",{className:"row text-center",children:t.jsx("div",{className:"col-xs-4",children:v.map((e,a)=>t.jsxs("div",{style:{position:"relative",display:"inline-block",marginRight:8,marginBottom:8},children:[t.jsx("img",{src:e,width:"100",height:"auto",alt:"preview"}),t.jsx(l,{variant:"link",className:"p-0","aria-label":"Remove image",onClick:()=>{try{URL.revokeObjectURL(e)}catch(n){console.log(n)}x(n=>n.filter((r,i)=>i!==a)),m(n=>{const r=f.current;if(a<r)return f.current=Math.max(0,r-1),n;const i=a-r;return{...n,images:n.images.filter((ae,O)=>O!==i)}})},style:{position:"absolute",top:-6,right:-6,border:"none",background:"transparent",padding:0,cursor:"pointer"},children:t.jsx("img",{src:y.ic_clear,alt:"clear",width:18,height:18})})]},`${e}-${a}`))})})})}):t.jsx("div",{style:{marginBottom:10}}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{children:"Mô tả"}),t.jsx(h.Control,{as:"textarea",rows:8,value:s.content,onChange:e=>m(a=>({...a,content:e.target.value})),placeholder:"Nhập nội dung mô tả (hỗ trợ HTML nếu cần)"})]})]}),t.jsxs(o.Footer,{children:[t.jsx(l,{variant:"secondary",type:"button",onClick:()=>{u(!1)},children:"Đóng"}),t.jsx(l,{type:"submit",children:"Lưu"})]})]})}),t.jsxs(o,{show:p.show,onHide:()=>g({show:!1,id:null,label:""}),centered:!0,animation:!1,backdrop:"static",children:[t.jsx(o.Header,{closeButton:!0,children:t.jsx(o.Title,{children:"Xác nhận xoá"})}),t.jsxs(o.Body,{children:['Bạn có chắc muốn xoá tin khuyến mãi "',p.label,'" không?']}),t.jsxs(o.Footer,{children:[t.jsx(l,{variant:"secondary",type:"button",onClick:()=>g({show:!1,id:null,label:""}),children:"Huỷ"}),t.jsx(l,{variant:"danger",type:"button",onClick:async()=>{p.id&&(await E(p.id),g({show:!1,id:null,label:""}))},children:"Xoá"})]})]})]})},ne={title:`Tin tức - ${G.appName}`};function xe(){return t.jsxs(t.Fragment,{children:[t.jsx(X,{children:t.jsxs("title",{children:[" ",ne.title]})}),t.jsx(te,{})]})}export{xe as default};
