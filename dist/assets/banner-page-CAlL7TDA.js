import{R as $,e as i,r as d,j as e,Q as U,B as m,I as E,c as p}from"./index-CvJx62Zl.js";import{C as x}from"./Carousel-CGx7_7vs.js";import{F as j}from"./Form-B0TxpSMS.js";import"./useWillUnmount-CLlPHptt.js";import"./ElementChildren-Ce4dmsvR.js";const L=$.injectEndpoints({endpoints:o=>({getCarousels:o.query({query:()=>({url:i.dashboard.carousels,method:"GET"})}),getCarousel:o.query({query:r=>({url:`${i.dashboard.carousels}/${r}`,method:"GET"})}),createCarousel:o.mutation({query:({body:r})=>({url:i.dashboard.carousels,method:"POST",body:r})}),updateCarousel:o.mutation({query:({id:r,body:n})=>({url:`${i.dashboard.carousels}/${r}`,method:"PUT",body:n})}),deleteCarousel:o.mutation({query:({id:r})=>({url:`${i.dashboard.carousels}/${r}`,method:"DELETE"})})})}),{useGetCarouselsQuery:F,useGetCarouselQuery:G,useCreateCarouselMutation:N,useUpdateCarouselMutation:I,useDeleteCarouselMutation:Q}=L,k=()=>{const[o,r]=d.useState([]),[n,h]=d.useState([]),[b,y]=d.useState(!1),{data:u=[]}=F(),[C]=N(),f=t=>{const a=t.target.files,s=a?Array.from(a):[];r(s);const l=s.map(c=>URL.createObjectURL(c));h(l)},g=t=>{const a=n[t];try{URL.revokeObjectURL(a)}catch(s){console.log(s)}h(s=>s.filter((l,c)=>c!==t)),r(s=>s.filter((l,c)=>c!==t))},v=()=>{n.forEach(t=>{try{URL.revokeObjectURL(t)}catch(a){console.log(a)}}),r([]),h([])},R=async()=>{if(!o.length){p.warning("Vui lòng chọn hình ảnh!");return}try{y(!0);const t=new FormData;o.forEach(a=>t.append("images",a)),await C({body:t}).unwrap(),p.success("Lưu carousel thành công!")}catch{p.error("Có lỗi xảy ra")}finally{y(!1)}},w=d.useMemo(()=>{var a;const t=n.length?n:(((a=u==null?void 0:u[0])==null?void 0:a.images)||[]).map(s=>(s==null?void 0:s.url)||(s==null?void 0:s.key)).filter(Boolean);return t.length?e.jsx("div",{style:{maxWidth:1920,margin:"0 auto"},children:e.jsx(x,{interval:2e3,indicators:!0,pause:!1,slide:!1,children:t.map((s,l)=>e.jsx(x.Item,{children:e.jsx("img",{src:s,alt:`banner-${l}`,style:{width:"100%",height:"auto",aspectRatio:"1920 / 700",objectFit:"cover",borderRadius:8}})},`${s}-${l}`))})}):null},[n,u]);return e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"mt-10",children:"Quản lý Banner Carousel"}),e.jsx(U,{autoClose:1e3}),e.jsx("div",{className:"mb-3",children:e.jsxs(j.Group,{controlId:"banner-upload",children:[e.jsx(j.Label,{children:"Chọn ảnh banner (có thể chọn nhiều ảnh)"}),e.jsx(j.Control,{type:"file",multiple:!0,onChange:f})]})}),n.length>0?e.jsx("div",{className:"mb-3",children:e.jsx("div",{className:"d-flex flex-wrap",children:n.map((t,a)=>e.jsxs("div",{style:{position:"relative",padding:8},children:[e.jsx("img",{src:t,alt:`preview-${a}`,width:140,height:90,style:{objectFit:"cover",borderRadius:6}}),e.jsx(m,{variant:"link",className:"p-0",style:{position:"absolute",top:2,right:2},onClick:()=>g(a),"aria-label":"Remove",children:e.jsx("img",{src:E.ic_clear,alt:"clear",width:18,height:18})})]},`${t}-${a}`))})}):null,e.jsxs("div",{className:"mb-3",children:[e.jsx(m,{type:"button",className:"btn btn-primary mr-10",onClick:R,disabled:b||!o.length,children:"Lưu banner"}),e.jsx(m,{type:"button",variant:"secondary",onClick:v,disabled:!o.length,children:"Xoá tất cả"})]}),e.jsx("div",{className:"mt-4",children:w})]})},S=()=>e.jsx(k,{});export{S as default};
