import{r as c,j as e,d as S,I as y,B as l,Q as U,c as d,H as X,f as Y}from"./index-CvJx62Zl.js";import{f as G}from"./format-time-CtTWvXUx.js";import{e as V}from"./index.es-JOJxY1ZJ.js";import{f as Q}from"./format-string-Cee-rHUc.js";import{c as q}from"./styles-Bw6Lb06x.js";import{u as z,a as K,b as W,c as J}from"./promotions-BnUlVxyr.js";import{M as r}from"./Modal-DBHGt8c5.js";import{F as h}from"./Form-B0TxpSMS.js";import{o as Z,s as ee}from"./types-BvcOK83k.js";import"./useWillUnmount-CLlPHptt.js";import"./ElementChildren-Ce4dmsvR.js";const te=()=>{const{data:T=[],isLoading:A,refetch:b}=z(),[M]=K(),[k]=W(),[F]=J(),C={id:null,name:"",content:"",endDate:new Date().toISOString(),isActive:!1,images:[]},[a,m]=c.useState(C),[H,u]=c.useState(!1),[P,N]=c.useState("Thêm tin khuyến mãi"),[g,p]=c.useState({show:!1,id:null,label:""}),[v,f]=c.useState([]),x=c.useRef(0),[w,j]=c.useState({}),B=Z({name:ee().min(1,"Vui lòng điền tiêu đề!")}),D=()=>{m(C),f([]),j({}),x.current=0},I=t=>{m({id:t.id,name:t.name||"",content:t.content||"",endDate:t.endDate||new Date().toISOString(),isActive:!!t.isActive,images:[]});const s=Array.isArray(t==null?void 0:t.images)?t.images.map(n=>n!=null&&n.key?String(n.key):null).filter(Boolean).map(n=>S(`${n}`)):[];f(s),x.current=s.length,N("Cập nhật tin khuyến mãi"),u(!0)},L=t=>{const s=t.name||`#${t.id}`;p({show:!0,id:t.id,label:s})},R=async t=>{try{await k({id:t.id,body:{isActive:!t.isActive}}).unwrap(),d.success("Cập nhật thành công"),b()}catch{}},E=async t=>{try{await F({id:t}).unwrap(),d.success("Xóa thành công"),b()}catch{d.error("Có lỗi xảy ra")}},_=async t=>{t.preventDefault();const s=B.safeParse({name:a.name});if(!s.success){const n={};s.error.issues.forEach(o=>{const i=o.path[0];i&&!n[i]&&(n[i]=o.message)}),j(n);return}j({});try{if(a.id)await k({id:a.id,body:{name:a.name,content:a.content,slug:a.name,endDate:a.endDate||new Date().toISOString()}}).unwrap(),d.success("Cập nhật thành công!");else{const n=new FormData;n.append("name",a.name),n.append("content",a.content),n.append("endDate",a.endDate),n.append("isActive",String(a.isActive)),n.append("slug",a.name),a.images&&a.images.length>0&&a.images.forEach(o=>n.append("images",o)),await M({body:n}).unwrap(),d.success("Thêm thành công!")}u(!1),D(),b()}catch{d.error("Có lỗi xảy ra")}},$=c.useMemo(()=>[{name:"#",selector:"id",sortable:!0},{name:"Tiêu đề",selector:"name",sortable:!0},{name:"Hình ảnh",selector:t=>{var s,n;return((n=(s=t.images)==null?void 0:s[0])==null?void 0:n.key)||""},cell:t=>{var o,i;const s=(i=(o=t.images)==null?void 0:o[0])==null?void 0:i.key,n=s?S(`${s}`):y.logo;return e.jsx("img",{src:n,alt:t.name,width:80,height:"auto"})}},{name:"Nội dung",selector:"content",grow:3,cell:t=>e.jsx("div",{style:{maxWidth:400,overflow:"hidden"},dangerouslySetInnerHTML:{__html:Q(t.content||"")}})},{name:"Ngày kết thúc",selector:"endDate",sortable:!0,right:!0,cell:t=>e.jsx("span",{children:G(t.endDate,"DD/MM/YYYY")})},{name:"Hiển thị",selector:"isActive",right:!0,cell:t=>e.jsx(l,{variant:"link",className:"p-0",onClick:()=>R(t),"aria-label":t.isActive?"Ẩn":"Hiện",children:e.jsx("img",{src:t.isActive?y.icEye:y.icNoEye,alt:t.isActive?"active":"inactive",width:25})})},{name:"Chức năng",selector:t=>t.id,cell:t=>e.jsxs(e.Fragment,{children:[e.jsx(l,{type:"button",className:"btn btn-warning white mr-10",onClick:()=>I(t),children:"Sửa"}),e.jsx(l,{type:"button",className:"btn btn-danger white",onClick:()=>L(t),children:"Xoá"})]})}],[]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between mt-10 mbt-10",children:[e.jsx("h1",{className:"m-0",children:"Tin Khuyến mãi"}),e.jsx("div",{children:e.jsx(l,{type:"button",className:"btn btn-primary",onClick:()=>{u(!0),N("Thêm tin khuyến mãi"),D()},children:"Thêm khuyến mãi"})})]}),e.jsx(U,{autoClose:1e3}),e.jsx(V,{title:"",columns:$,data:T,defaultSortFieldId:"title",pagination:!0,progressPending:A,responsive:!0,dense:!0,customStyles:q}),e.jsx(r,{size:"lg","aria-labelledby":"contained-modal-title-vcenter",centered:!0,show:H,onHide:()=>{u(!1)},animation:!1,backdrop:"static",children:e.jsxs(h,{onSubmit:_,noValidate:!0,children:[e.jsx(r.Header,{closeButton:!0,children:e.jsxs(r.Title,{children:[" ",P]})}),e.jsxs(r.Body,{className:"news-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Tiêu đề"}),e.jsx(h.Control,{className:`form-control ${w.name?"is-invalid":""}`,value:a.name,name:"name",placeholder:"Nhập tiêu đề",onChange:t=>{m(s=>({...s,name:t.target.value})),j(s=>({...s,name:void 0}))}}),e.jsx("div",{className:`invalid-feedback ${w.name?"d-block":""}`,children:w.name})]}),e.jsxs(h.Group,{controlId:"promotion-images",className:"form-group",children:[e.jsx(h.Label,{children:"Hình ảnh (hình đầu tiên sẽ là mặc định)"}),e.jsx(h.Control,{type:"file",multiple:!0,onChange:t=>{const s=t.target.files,n=s?Array.from(s):[];if(!n.length)return;m(i=>({...i,images:[...i.images,...n]}));const o=n.map(i=>URL.createObjectURL(i));f(i=>[...i,...o])}})]}),v&&v.length>0?e.jsx("div",{className:"mbt-10 show_image",children:e.jsx("div",{className:"container testimonial-group",children:e.jsx("div",{className:"row text-center",children:e.jsx("div",{className:"col-xs-4",children:v.map((t,s)=>e.jsxs("div",{style:{position:"relative",display:"inline-block",marginRight:8,marginBottom:8},children:[e.jsx("img",{src:t,width:"100",height:"auto",alt:"preview"}),e.jsx(l,{variant:"link",className:"p-0","aria-label":"Remove image",onClick:()=>{try{URL.revokeObjectURL(t)}catch(n){console.log(n)}f(n=>n.filter((o,i)=>i!==s)),m(n=>{const o=x.current;if(s<o)return x.current=Math.max(0,o-1),n;const i=s-o;return{...n,images:n.images.filter((se,O)=>O!==i)}})},style:{position:"absolute",top:-6,right:-6,border:"none",background:"transparent",padding:0,cursor:"pointer"},children:e.jsx("img",{src:y.ic_clear,alt:"clear",width:18,height:18})})]},`${t}-${s}`))})})})}):e.jsx("div",{style:{marginBottom:10}}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Mô tả"}),e.jsx(h.Control,{as:"textarea",rows:8,value:a.content,onChange:t=>m(s=>({...s,content:t.target.value})),placeholder:"Nhập nội dung mô tả (hỗ trợ HTML nếu cần)"})]})]}),e.jsxs(r.Footer,{children:[e.jsx(l,{variant:"secondary",type:"button",onClick:()=>{u(!1)},children:"Đóng"}),e.jsx(l,{type:"submit",children:"Lưu"})]})]})}),e.jsxs(r,{show:g.show,onHide:()=>p({show:!1,id:null,label:""}),centered:!0,animation:!1,backdrop:"static",children:[e.jsx(r.Header,{closeButton:!0,children:e.jsx(r.Title,{children:"Xác nhận xoá"})}),e.jsxs(r.Body,{children:['Bạn có chắc muốn xoá tin khuyến mãi "',g.label,'" không?']}),e.jsxs(r.Footer,{children:[e.jsx(l,{variant:"secondary",type:"button",onClick:()=>p({show:!1,id:null,label:""}),children:"Huỷ"}),e.jsx(l,{variant:"danger",type:"button",onClick:async()=>{g.id&&(await E(g.id),p({show:!1,id:null,label:""}))},children:"Xoá"})]})]})]})},ne={title:`Tin tức - ${Y.appName}`};function pe(){return e.jsxs(e.Fragment,{children:[e.jsx(X,{children:e.jsxs("title",{children:[" ",ne.title]})}),e.jsx(te,{})]})}export{pe as default};
