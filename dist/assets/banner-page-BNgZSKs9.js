import{r as d,j as t,A as I,s as g,Q as S,X as _,M as v,F as L,v as C,w as E}from"./vendor-react-D439mYZB.js";import{r as U,I as $,C as H}from"./index-CCO37Pg2.js";import{b as A,f as B}from"./format-time-CqX4gBLH.js";import{c as P}from"./styles-Bw6Lb06x.js";import{u as z,a as O,b as X}from"./carousel-BpZmWe25.js";import"./vendor-misc-BkUckcGj.js";import"./vendor-redux-CY9rYXZh.js";import"./vendor-ui-qtF25uBn.js";import"./vendor-utils-DifT8CeW.js";const W={maxWidth:1920,maxHeight:1080,quality:.8,mimeType:"image/jpeg",thresholdBytes:1024*1024};function G(s,c,n,o){const i=Math.min(n/s,o/c,1);return{width:Math.round(s*i),height:Math.round(c*i)}}async function Q(s,c){const n={...W};if(!s||!s.type.startsWith("image/")||s.size<=n.thresholdBytes)return s;const o=URL.createObjectURL(s);try{const i=await new Promise((b,f)=>{const m=new Image;m.onload=()=>b(m),m.onerror=N=>f(N),m.src=o}),{width:x,height:h}=G(i.naturalWidth||i.width,i.naturalHeight||i.height,n.maxWidth,n.maxHeight),l=document.createElement("canvas");l.width=x,l.height=h;const R=l.getContext("2d");if(!R)return s;R.drawImage(i,0,0,x,h);const y=await new Promise(b=>l.toBlob(f=>b(f),n.mimeType,n.quality));if(!y||y.size>=s.size)return s;const k=n.mimeType==="image/png"?"png":n.mimeType==="image/webp"?"webp":"jpg",j=s.name.replace(/\.[^/.]+$/,"");return new File([y],`${j}.compressed.${k}`,{type:n.mimeType,lastModified:Date.now()})}catch{return s}finally{URL.revokeObjectURL(o)}}async function V(s,c){return Promise.all(s.map(n=>Q(n)))}const q=()=>{const[s,c]=d.useState([]),[n,o]=d.useState([]),[i,x]=d.useState(!1),{data:h=[],refetch:l}=z(),[R]=O(),[y]=X(),[k,j]=d.useState(!1),u=d.useRef(null),b=e=>{const a=e.target.files,r=a?Array.from(a):[];c(r);const p=r.map(w=>URL.createObjectURL(w));o(p)},f=e=>{const a=n[e];try{URL.revokeObjectURL(a)}catch{}const r=n.filter((w,F)=>F!==e),p=s.filter((w,F)=>F!==e);o(r),c(p),p.length===0&&u.current&&(u.current.value="")},m=()=>{n.forEach(e=>{try{URL.revokeObjectURL(e)}catch{}}),c([]),o([]),u.current&&(u.current.value="")},N=async()=>{if(!s.length){C.warning("Vui lòng chọn hình ảnh!");return}try{x(!0);const e=await V(s);await Promise.all(e.map(a=>{const r=new FormData;return r.append("name",`Banner ${a.name}`),r.append("isActive","true"),r.append("image",a),R({body:r}).unwrap()})),C.success("Lưu carousel thành công!"),j(!1),m(),l()}catch{C.error("Có lỗi xảy ra")}finally{x(!1)}},D=async e=>{if(window.confirm("Bạn có chắc muốn xoá banner này?"))try{await y({id:e}).unwrap(),C.success("Xoá thành công"),l()}catch{C.error("Có lỗi xảy ra")}},T=d.useMemo(()=>{const e=n.length?n:(h||[]).map(a=>a?.image?.url||(a?.image?.key?U(a?.image?.key):"")).filter(a=>!!a);return e.length?t.jsx("div",{style:{maxWidth:1920,margin:"0 auto"},children:t.jsx(I,{interval:2e3,indicators:!0,pause:!1,slide:!1,children:e.map((a,r)=>t.jsx(I.Item,{children:t.jsx("img",{src:a,alt:`banner-${r}`,style:{width:"100%",height:"auto",aspectRatio:"1920 / 700",objectFit:"cover",borderRadius:8},onError:p=>{try{p.currentTarget.style.display="none"}catch{}}})},`${a}-${r}`))})}):null},[n,h]),M=d.useMemo(()=>[{name:"Vị trí",selector:(e,a)=>String((a??0)+1),width:"80px"},{name:"Hình ảnh",selector:e=>e?.image?.key||e?.image?.url||"",cell:e=>{const a=e?.image?.url||U(e?.image?.key||"");return t.jsx("img",{src:a||$.image,alt:e?.name||"banner",width:140,height:90,style:{objectFit:"cover",borderRadius:6}})},width:"220px"},{name:"Link",selector:e=>e?.image?.key||e?.image?.url||"",cell:e=>{const a=e?.image?.url||U(e?.image?.key||"");return a?t.jsx("a",{href:a,target:"_blank",rel:"noreferrer","aria-label":"Xem",children:t.jsx("img",{src:$.icEye,alt:"view",width:18,height:18})}):null},width:"120px"},{name:"Ngày tạo",selector:e=>e?.createDate||e?.createdAt||"",cell:e=>`${A(e?.createDate||e?.createdAt)} ${B(e?.createDate||e?.createdAt)}`},{name:"Ngày cập nhật",selector:e=>e?.writeDate||e?.updatedAt||"",cell:e=>`${A(e?.writeDate||e?.updatedAt)} ${B(e?.writeDate||e?.updatedAt)}`},{name:"Chức năng",selector:e=>e?.id,cell:e=>t.jsxs(t.Fragment,{children:[t.jsx(g,{type:"button",className:"btn btn-warning white mr-10",onClick:()=>{},children:"Sửa"}),t.jsx(g,{type:"button",className:"btn btn-danger white",onClick:()=>D(e.id),children:"Xóa"})]}),width:"180px"}],[]);return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-10 mb-3",children:[t.jsx("h1",{className:"m-0",children:"Quản lý Banner"}),t.jsx(g,{onClick:()=>j(!0),children:"Thêm"})]}),t.jsx(S,{autoClose:1e3}),t.jsx(_,{title:"",columns:M,data:h,pagination:!0,responsive:!0,dense:!0,customStyles:P}),t.jsxs(v,{show:k,onHide:()=>j(!1),centered:!0,size:"lg",children:[t.jsx(v.Header,{closeButton:!0,children:t.jsx(v.Title,{children:"Thêm banner"})}),t.jsxs(v.Body,{children:[t.jsx("div",{className:"mb-3",children:t.jsxs(L.Group,{controlId:"banner-upload",children:[t.jsx(L.Label,{children:"Chọn ảnh banner"}),t.jsx(L.Control,{ref:u,type:"file",onChange:b})]})}),n.length>0?t.jsx("div",{className:"mb-3",children:t.jsx("div",{className:"d-flex flex-wrap",children:n.map((e,a)=>t.jsxs("div",{style:{position:"relative",padding:8},children:[t.jsx("img",{src:e,alt:`preview-${a}`,width:140,height:90,style:{objectFit:"cover",borderRadius:6}}),t.jsx(g,{variant:"link",className:"p-0",style:{position:"absolute",top:2,right:2},onClick:()=>f(a),"aria-label":"Remove",children:t.jsx("img",{src:$.ic_clear,alt:"clear",width:18,height:18})})]},`${e}-${a}`))})}):null]}),t.jsxs(v.Footer,{children:[t.jsx(g,{variant:"secondary",onClick:m,disabled:!s.length,children:"Xoá tất cả"}),t.jsx(g,{type:"button",className:"btn btn-primary",onClick:N,disabled:i||!s.length,children:"Lưu banner"})]})]}),t.jsx("div",{className:"mt-4",children:T})]})},J={title:`Banner - ${H.appName}`};function ie(){return t.jsxs(t.Fragment,{children:[t.jsx(E,{children:t.jsxs("title",{children:[" ",J.title]})}),t.jsx(q,{})]})}export{ie as default};
