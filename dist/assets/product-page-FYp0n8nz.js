import{k as Z,a as ee,G as te,J as se,K as ae,j as e,r as M,I as y,B as u,Q as ne,c as v,L as E,H as ie,d as le}from"./index-Cisqq87o.js";import{r as x}from"./vendor-D10guwLI.js";import{f as S}from"./format-number-DeezL_hy.js";import{e as re}from"./index.es-3P-hqikk.js";import{f as ce}from"./format-string-Cee-rHUc.js";import{u as oe}from"./category-DF8oV3zg.js";import{b as de}from"./index-BDLNoMlA.js";import{c as me}from"./styles-Bw6Lb06x.js";import{M as p}from"./Modal-BE1P8Ww6.js";import{F as h}from"./Form-B4CIVEzx.js";import{o as ue,s as j,u as F,n as Q}from"./types-BvcOK83k.js";const he=()=>{const{data:_=[],isLoading:B,refetch:b}=Z(),D=ee(),{data:A=[]}=oe(),[L]=te(),[C]=se(),[H]=ae(),T={id:null,name:"",unit:"",description:"",displayPrice:0,sellPrice:0,stockQuantity:0,isFeature:!0,isActive:!0,shopeeUrl:"",categoryId:"",images:[]},[a,m]=x.useState(T),[R,f]=x.useState(!1),[V,$]=x.useState("Thêm sản phẩm"),[r,g]=x.useState({}),[P,k]=x.useState([]),N=x.useRef(0),[w,I]=x.useState({show:!1,id:null,label:""}),G=ue({name:j().min(1,"Vui lòng nhập tên sản phẩm!"),unit:j().min(1,"Vui lòng nhập đơn vị!"),categoryId:F([j(),Q()]).refine(t=>String(t).length>0,"Vui lòng chọn danh mục!"),sellPrice:F([j(),Q()]).refine(t=>String(t).length>0,"Vui lòng nhập giá tiền!"),stockQuantity:F([j(),Q()]).refine(t=>String(t).length>0,"Vui lòng nhập số lượng!"),description:j().min(1,"Vui lòng nhập mô tả!")}),U=()=>{m(T),k([]),g({}),N.current=0},X=t=>{var c,o;const s=Array.isArray(t==null?void 0:t.categoriesId)?t.categoriesId[0]:void 0,i=Array.isArray(t==null?void 0:t.categories)?(o=(c=t.categories)==null?void 0:c[0])==null?void 0:o.id:void 0,l=s??i??"";m({id:t.id,name:t.name||"",unit:t.unit||"",description:t.description||"",displayPrice:t.displayPrice||0,sellPrice:S(t.sellPrice||0),stockQuantity:String(t.stockQuantity||0),isFeature:!!t.isFeature,isActive:!!t.isActive,shopeeUrl:t.shopeeUrl||"",categoryId:l,images:[]});const n=Array.isArray(t==null?void 0:t.images)?t.images.map(d=>d!=null&&d.key?String(d.key):null).filter(Boolean).map(d=>M(`${d}`)):[];k(n),N.current=n.length,$("Cập nhật sản phẩm"),f(!0)},O=t=>{const s=t.name||`#${t.id}`;I({show:!0,id:t.id,label:s})},z=async t=>{try{await H({id:t}).unwrap(),v.success("Xóa thành công"),b()}catch{v.error("Có lỗi xảy ra")}},q=async t=>{try{await C({id:t.id,body:{isFeature:!t.isFeature}}).unwrap(),v.success("Cập nhật thành công"),b()}catch(s){console.log(s)}},J=async t=>{try{await C({id:t.id,body:{isActive:!t.isActive}}).unwrap(),v.success("Cập nhật thành công"),b()}catch(s){console.log(s)}},K=async t=>{var i,l;t.preventDefault();const s=G.safeParse({name:a.name,unit:a.unit,categoryId:a.categoryId,sellPrice:a.sellPrice,stockQuantity:a.stockQuantity,description:a.description});if(!s.success){const n={};s.error.issues.forEach(c=>{const o=c.path[0];o&&!n[o]&&(n[o]=c.message)}),g(n);return}g({});try{if(a.id){let n=[];if(a.images&&a.images.length>0){const o=new FormData;a.images.forEach(Y=>o.append("medias",Y));const d=await E.post("media",o,{headers:{"Content-Type":"multipart/form-data"}});n=((i=d==null?void 0:d.data)==null?void 0:i.mediasId)||[]}const c={name:a.name,unit:a.unit,description:a.description,displayPrice:parseInt(String(a.displayPrice||0).replace(/[^\d]/g,""),10),sellPrice:parseInt(String(a.sellPrice||0).replace(/[^\d]/g,""),10),stockQuantity:parseInt(String(a.stockQuantity||0).replace(/[^\d]/g,""),10),isFeature:a.isFeature,isActive:a.isActive,shopeeUrl:a.shopeeUrl,categoriesId:[parseInt(String(a.categoryId),10)]};n.length>0&&(c.imagesId=n),await C({id:a.id,body:c}).unwrap(),v.success("Cập nhật thành công!")}else{const n=new FormData;a.images&&a.images.length>0&&a.images.forEach(d=>n.append("medias",d));const c=await E.post("media",n,{headers:{"Content-Type":"multipart/form-data"}}),o=((l=c==null?void 0:c.data)==null?void 0:l.mediasId)||[];await L({body:{name:a.name,unit:a.unit,description:a.description,displayPrice:parseInt(String(a.displayPrice||0).replace(/[^\d]/g,""),10),sellPrice:parseInt(String(a.sellPrice||0).replace(/[^\d]/g,""),10),stockQuantity:parseInt(String(a.stockQuantity||0).replace(/[^\d]/g,""),10),isFeature:a.isFeature,isActive:a.isActive,shopeeUrl:a.shopeeUrl,categoriesId:[parseInt(String(a.categoryId),10)],imagesId:o}}).unwrap(),v.success("Thêm thành công!")}f(!1),U(),b()}catch{v.error("Có lỗi xảy ra")}},W=x.useMemo(()=>[{name:"#",selector:"id",sortable:!0},{name:"Tên sản phẩm",selector:"name",sortable:!0},{name:"Hình ảnh",selector:t=>{var s,i;return((i=(s=t.images)==null?void 0:s[0])==null?void 0:i.key)||""},cell:t=>{var l,n;const s=(n=(l=t.images)==null?void 0:l[0])==null?void 0:n.key,i=s?M(`${s}`):y.logo;return e.jsx("div",{style:{padding:8},children:e.jsx(de.LazyLoadImage,{src:i,alt:t.name,width:80,height:80,effect:"blur",placeholderSrc:y.logo,style:{objectFit:"cover",borderRadius:4}})})}},{name:"Giá tiền",selector:"sellPrice",cell:t=>e.jsxs("span",{children:[S(t.sellPrice)," VNĐ"]})},{name:"Đã bán",selector:"soldQuantity"},{name:"Đơn vị",selector:"unit"},{name:"Số lượng",selector:"stockQuantity"},{name:"Mô tả",selector:"description",cell:t=>e.jsx("div",{style:{maxWidth:400,overflow:"hidden"},children:ce(t.description||"")})},{name:"Nổi bật",selector:"isFeature",cell:t=>e.jsx(u,{variant:"link",className:"p-0",onClick:()=>q(t),children:e.jsx("img",{src:t.isFeature?y.icEye:y.icNoEye,alt:"feature",width:25})})},{name:"Hiển thị",selector:"isActive",cell:t=>e.jsx(u,{variant:"link",className:"p-0",onClick:()=>J(t),children:e.jsx("img",{src:t.isActive?y.icEye:y.icNoEye,alt:"active",width:25})})},{name:"Chức năng",selector:t=>t.id,cell:t=>e.jsxs(e.Fragment,{children:[e.jsx(u,{type:"button",className:"btn btn-warning white mr-10",onClick:()=>X(t),children:"Sửa"}),e.jsx(u,{type:"button",className:"btn btn-danger white",onClick:()=>O(t),children:"Xoá"})]})}],[]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between mt-10 mbt-10",children:[e.jsx("h1",{className:"m-0",children:"Danh sách sản phẩm"}),e.jsxs("div",{children:[e.jsx(u,{type:"button",className:"btn btn-primary",onClick:()=>{f(!0),$("Thêm sản phẩm"),U()},children:"Thêm sản phẩm"}),e.jsx(u,{variant:"success",className:"ml-10",type:"button",onClick:()=>{D.push("https://kemnhanonline.vn/api/products/export")},children:"Xuất Excel"})]})]}),e.jsx(ne,{autoClose:1e3}),e.jsx(re,{title:"",columns:W,data:_,defaultSortFieldId:"title",pagination:!0,progressPending:B,responsive:!0,dense:!0,customStyles:me}),e.jsx(p,{size:"lg","aria-labelledby":"contained-modal-title-vcenter",centered:!0,show:R,onHide:()=>{f(!1)},animation:!1,backdrop:"static",children:e.jsxs(h,{onSubmit:K,noValidate:!0,children:[e.jsx(p.Header,{closeButton:!0,children:e.jsx(p.Title,{children:V.toString()})}),e.jsxs(p.Body,{className:"product-form",children:[e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:" form-group col-6",children:[e.jsxs("label",{children:["Danh Mục ",e.jsx("sup",{className:"sub_text",children:"*"})]}),e.jsxs(h.Control,{as:"select",className:`form-control ${r.categoryId?"is-invalid":""}`,value:String(a.categoryId),onChange:t=>{m(s=>({...s,categoryId:t.target.value})),g(s=>({...s,categoryId:void 0}))},children:[e.jsx("option",{value:"",children:"Thêm danh mục"}),A&&A.map((t,s)=>e.jsx("option",{value:t.id,children:t.name},s))]}),e.jsx("div",{className:`invalid-feedback ${r.categoryId?"d-block":""}`,children:r.categoryId})]}),e.jsxs("div",{className:" form-group col-6",children:[e.jsxs("label",{children:["Tên sản phẩm ",e.jsx("sup",{className:"sub_text",children:"*"})]}),e.jsx(h.Control,{className:`form-control ${r.name?"is-invalid":""}`,name:"name",value:a.name,placeholder:"Nhập tên sản phẩm",onChange:t=>{m(s=>({...s,name:t.target.value})),g(s=>({...s,name:void 0}))}}),e.jsx("div",{className:`invalid-feedback ${r.name?"d-block":""}`,children:r.name})]})]}),e.jsxs(h.Group,{controlId:"product-images",children:[e.jsx(h.Label,{children:"Hình ảnh (hình đầu tiên sẽ là mặc định)"}),e.jsx(h.Control,{type:"file",multiple:!0,onChange:t=>{const s=t.target.files,i=s?Array.from(s):[];if(!i.length)return;m(n=>({...n,images:[...n.images,...i]}));const l=i.map(n=>URL.createObjectURL(n));k(n=>[...n,...l])}})]}),P&&P.length>0?e.jsx("div",{className:"mbt-10 show_image",children:e.jsx("div",{className:"container testimonial-group",children:e.jsx("div",{className:"row text-center",children:e.jsx("div",{className:"col-xs-4",children:P.map((t,s)=>e.jsxs("div",{style:{position:"relative",display:"inline-block",marginRight:8,marginBottom:8},children:[e.jsx("img",{src:t,width:"100",height:"auto",alt:"preview"}),e.jsx(u,{variant:"link",className:"p-0","aria-label":"Remove image",onClick:()=>{try{URL.revokeObjectURL(t)}catch(i){console.log(i)}k(i=>i.filter((l,n)=>n!==s)),m(i=>{const l=N.current;if(s<l)return N.current=Math.max(0,l-1),i;const n=s-l;return{...i,images:i.images.filter((c,o)=>o!==n)}})},style:{position:"absolute",top:-6,right:-6,border:"none",background:"transparent",padding:0,cursor:"pointer"},children:e.jsx("img",{src:y.ic_clear,alt:"clear",width:18,height:18})})]},`${t}-${s}`))})})})}):e.jsx("div",{style:{marginBottom:10}}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:" form-group col-6",children:[e.jsxs("label",{children:["Tiền ",e.jsx("sup",{className:"sub_text",children:"*"})]}),e.jsx(h.Control,{className:`form-control ${r.sellPrice?"is-invalid":""}`,type:"text",name:"sellPrice",placeholder:"Nhập giá tiền sản phẩm",value:String(a.sellPrice),onChange:t=>{const s=t.target.value.replace(/[^\d]/g,""),i=S(s);m(l=>({...l,sellPrice:i})),g(l=>({...l,sellPrice:void 0}))}}),e.jsx("div",{className:`invalid-feedback ${r.sellPrice?"d-block":""}`,children:r.sellPrice})]}),e.jsxs("div",{className:"form-group col-6",children:[e.jsxs("label",{children:["Đơn vị ",e.jsx("sup",{className:"sub_text",children:"*"})]}),e.jsx(h.Control,{className:`form-control ${r.unit?"is-invalid":""}`,name:"unit",placeholder:"Ví du: Hộp, Cái,...",value:a.unit,onChange:t=>{m(s=>({...s,unit:t.target.value})),g(s=>({...s,unit:void 0}))}}),e.jsx("div",{className:`invalid-feedback ${r.unit?"d-block":""}`,children:r.unit})]})]}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:" form-group col-6",children:[e.jsxs("label",{children:["Số lượng ",e.jsx("sup",{className:"sub_text",children:"*"})]}),e.jsx(h.Control,{className:`form-control ${r.stockQuantity?"is-invalid":""}`,type:"text",name:"stockQuantity",placeholder:"Nhập số lượng sản phẩm",value:String(a.stockQuantity),onChange:t=>{const s=t.target.value.replace(/[^\d]/g,""),i=Math.min(parseInt(s||"0",10),1e3);m(l=>({...l,stockQuantity:String(i)})),g(l=>({...l,stockQuantity:void 0}))}}),e.jsx("div",{className:`invalid-feedback ${r.stockQuantity?"d-block":""}`,children:r.stockQuantity})]}),e.jsxs("div",{className:" form-group col-6",children:[e.jsx("label",{children:" Link Shoppe (Nếu có)"}),e.jsx(h.Control,{className:"form-control",name:"shopeeUrl",placeholder:"Nhập link shoppee nếu có",value:a.shopeeUrl,onChange:t=>{m(s=>({...s,shopeeUrl:t.target.value}))}})]})]}),e.jsx("label",{children:" Mô tả "}),e.jsx(h.Control,{as:"textarea",rows:6,className:`form-control ${r.description?"is-invalid":""}`,placeholder:"Nhập mô tả sản phẩm",name:"description",value:a.description,onChange:t=>{m(s=>({...s,description:t.target.value})),g(s=>({...s,description:void 0}))}}),e.jsx("div",{className:`invalid-feedback ${r.description?"d-block":""}`,children:r.description})]}),e.jsxs(p.Footer,{children:[e.jsx(u,{variant:"secondary",type:"button",onClick:()=>{f(!1)},children:"Đóng"}),e.jsx(u,{type:"submit",children:"Lưu"})]})]})}),e.jsxs(p,{show:w.show,onHide:()=>I({show:!1,id:null,label:""}),centered:!0,animation:!1,backdrop:"static",children:[e.jsx(p.Header,{closeButton:!0,children:e.jsx(p.Title,{children:"Xác nhận xoá"})}),e.jsxs(p.Body,{children:['Bạn có chắc muốn xoá sản phẩm "',w.label,'" không?']}),e.jsxs(p.Footer,{children:[e.jsx(u,{variant:"secondary",type:"button",onClick:()=>I({show:!1,id:null,label:""}),children:"Huỷ"}),e.jsx(u,{variant:"danger",type:"button",onClick:async()=>{w.id&&(await z(w.id),I({show:!1,id:null,label:""}))},children:"Xoá"})]})]})]})},pe={title:`Sản phẩm - ${le.appName}`};function Ce(){return e.jsxs(e.Fragment,{children:[e.jsx(ie,{children:e.jsxs("title",{children:[" ",pe.title]})}),e.jsx(he,{})]})}export{Ce as default};
