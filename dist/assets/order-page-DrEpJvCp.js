import{R as T,e as x,r as g,j as e,B as a,I as S,Q as w,c as j,H as D,f as $}from"./index-CvJx62Zl.js";import{f as k}from"./format-time-CtTWvXUx.js";import{a as H}from"./format-number-DeezL_hy.js";import{e as v}from"./index.es-JOJxY1ZJ.js";import{c as B}from"./styles-Bw6Lb06x.js";import{M as r}from"./Modal-DBHGt8c5.js";import"./useWillUnmount-CLlPHptt.js";const E=T.injectEndpoints({endpoints:o=>({getOrders:o.query({query:()=>({url:x.dashboard.orders,method:"GET"})}),updateOrderStatus:o.mutation({query:({id:i,body:l})=>({url:`${x.dashboard.orders}/${i}`,method:"PUT",body:l})})})}),{useGetOrdersQuery:F,useUpdateOrderStatusMutation:M}=E,O=()=>{const{data:o=[],isLoading:i,refetch:l}=F(),[f]=M(),[s,c]=g.useState({show:!1,id:null,label:"",next:0}),u=(t,n)=>{var h,m,p;const d=`${((h=t.customer)==null?void 0:h.firstName)||""} ${((m=t.customer)==null?void 0:m.lastName)||""}`.trim()||((p=t.customer)==null?void 0:p.phone)||`#${t.id}`;c({show:!0,id:t.id,label:d,next:n})},y=async(t,n)=>{try{await f({id:t,body:{status:n}}).unwrap(),j.success("Success!"),l()}catch{j.error("Có lỗi xảy ra")}},b=()=>{window.open("https://kemnhanonline.vn/api/orders/export","_blank")},C=t=>t===1?"Chờ duyệt":t===2?"Đang giao hàng":t===3?"Hoàn thành đơn":"Từ chối đơn hàng",N=g.useMemo(()=>[{name:"#",selector:(t,n)=>n+1,width:"60px"},{name:"Họ tên",selector:t=>`${t.customer.firstName} ${t.customer.lastName}`,sortable:!0},{name:"Số điện thoại",selector:t=>t.customer.phone,sortable:!0},{name:"Tổng tiền",selector:t=>t.amountTotal,right:!0,cell:t=>e.jsx("span",{children:H(t.amountTotal,{currency:"VND"})})},{name:"Ghi chú",selector:t=>t.note||""},{name:"Ngày đặt",selector:t=>t.createDate,right:!0,cell:t=>e.jsx("span",{children:k(t.createDate,"DD/MM/YYYY")})},{name:"Trạng thái",selector:t=>t.status,cell:t=>e.jsx("span",{children:C(t.status)})},{name:"Chức năng",selector:t=>t.id,cell:t=>{const n=t.status===1?2:t.status===2?3:0;return e.jsxs(e.Fragment,{children:[n?e.jsx(a,{type:"button",className:"btn btn-primary mr-10",onClick:()=>u(t,n),children:t.status===1?"Duyệt đơn hàng":"Đã giao hàng"}):null,t.status!==4&&t.status!==3?e.jsx(a,{type:"button",className:"btn btn-danger",onClick:()=>u(t,4),children:"Từ chối đơn hàng"}):e.jsx("img",{src:S.information,alt:"info",width:20})]})}}],[]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between mt-10 mbt-10",children:[e.jsx("h1",{className:"m-0",children:"Danh sách đơn hàng"}),e.jsx("div",{children:e.jsx(a,{variant:"success",type:"button",onClick:b,children:"Xuất Excel"})})]}),e.jsx(w,{autoClose:1e3}),e.jsx(v,{title:"",columns:N,data:o,defaultSortFieldId:"title",pagination:!0,progressPending:i,responsive:!0,dense:!0,customStyles:B}),e.jsxs(r,{show:s.show,onHide:()=>c({show:!1,id:null,label:"",next:0}),centered:!0,backdrop:"static",children:[e.jsx(r.Header,{closeButton:!0,children:e.jsx(r.Title,{children:"Xác nhận cập nhật"})}),e.jsx(r.Body,{children:`Bạn muốn cập nhật trạng thái đơn hàng của "${s.label}"?`}),e.jsxs(r.Footer,{children:[e.jsx(a,{variant:"secondary",type:"button",onClick:()=>c({show:!1,id:null,label:"",next:0}),children:"Huỷ"}),e.jsx(a,{variant:"primary",type:"button",onClick:async()=>{!s.id||!s.next||(await y(s.id,s.next),c({show:!1,id:null,label:"",next:0}))},children:"Xác nhận"})]})]})]})},q={title:`Hóa đơn - ${$.appName}`};function Q(){return e.jsxs(e.Fragment,{children:[e.jsx(D,{children:e.jsxs("title",{children:[" ",q.title]})}),e.jsx(O,{})]})}export{Q as default};
