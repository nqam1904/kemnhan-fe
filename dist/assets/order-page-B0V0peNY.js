import{r as o,j as e,s as i,Q as w,X as C,M as n,v as j,w as H}from"./vendor-react-D439mYZB.js";import{a as Y,C as S}from"./index-CCO37Pg2.js";import{a as c}from"./format-number-D7I21mwK.js";import{f as h,a as M}from"./format-time-CqX4gBLH.js";import{c as k}from"./styles-Bw6Lb06x.js";import{a as V,b as F}from"./orders-CgAxjZou.js";import"./vendor-misc-BkUckcGj.js";import"./vendor-redux-CY9rYXZh.js";import"./vendor-ui-qtF25uBn.js";import"./vendor-utils-DifT8CeW.js";const $=()=>{const{data:p=[],isLoading:g,refetch:y}=V(),N=Y(),[b]=F(),[l,a]=o.useState({show:!1,id:null,label:"",next:0}),[t,d]=o.useState({show:!1,order:null}),x=(s,r)=>{const u=`${s.customer?.firstName||""} ${s.customer?.lastName||""}`.trim()||s.customer?.phone||`#${s.id}`;a({show:!0,id:s.id,label:u,next:r})},D=s=>{d({show:!0,order:s})},f=async(s,r)=>{try{await b({id:s,body:{status:r}}).unwrap(),j.success("Success!"),y()}catch{j.error("Có lỗi xảy ra")}},v=()=>{N.push("https://kemnhanonline.vn/api/orders/export")},m=s=>s===1?"Chờ duyệt":s===2?"Đang giao hàng":s===3?"Hoàn thành đơn":"Từ chối đơn hàng",T=o.useMemo(()=>[{name:"#",selector:(s,r)=>r+1,width:"60px"},{name:"Họ tên",selector:s=>`${s.customer.firstName} ${s.customer.lastName}`,sortable:!0},{name:"Số điện thoại",selector:s=>s.customer.phone,sortable:!0},{name:"Tổng tiền",selector:s=>s.amountTotal,right:!0,cell:s=>e.jsx("span",{children:c(s.amountTotal,{currency:"VND"})})},{name:"Ghi chú",selector:s=>s.note||""},{name:"Ngày đặt",selector:s=>s.createDate,right:!0,cell:s=>e.jsx("span",{children:h(s.createDate,"DD/MM/YYYY")})},{name:"Ngày cập nhật",selector:s=>s.writeDate,right:!0,cell:s=>e.jsx("span",{children:M(s.writeDate,"HH:mm DD/MM/YYYY")})},{name:"Trạng thái",selector:s=>s.status,cell:s=>e.jsx("span",{children:m(s.status)})},{name:"Chức năng",selector:s=>s.id,cell:s=>{const r=s.status===1?2:s.status===2?3:0;return e.jsxs(e.Fragment,{children:[r?e.jsx(i,{type:"button",className:`btn ${s.status===1?"btn-primary":"btn-success"} mr-10`,onClick:()=>x(s,r),children:s.status===1?"Duyệt":"Đã giao hàng"}):null,s.status!==4&&s.status!==3?e.jsx(i,{type:"button",className:"btn btn-danger",onClick:()=>x(s,4),children:"Từ chối"}):null,e.jsx(i,{type:"button",className:"btn btn-primary btn-sm ml-2",onClick:()=>D(s),children:"Xem chi tiết"})]})}}],[]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between mt-10 mbt-10",children:[e.jsx("h1",{className:"m-0",children:"Danh sách đơn hàng"}),e.jsx("div",{children:e.jsx(i,{variant:"success",type:"button",onClick:v,children:"Xuất Excel"})})]}),e.jsx(w,{autoClose:1e3}),e.jsx(C,{title:"",columns:T,data:p,defaultSortFieldId:"title",pagination:!0,progressPending:g,responsive:!0,dense:!0,customStyles:k}),e.jsxs(n,{show:l.show,onHide:()=>a({show:!1,id:null,label:"",next:0}),centered:!0,backdrop:"static",children:[e.jsx(n.Header,{closeButton:!0,children:e.jsx(n.Title,{children:"Xác nhận cập nhật"})}),e.jsx(n.Body,{children:`Bạn muốn cập nhật trạng thái đơn hàng của "${l.label}"?`}),e.jsxs(n.Footer,{children:[e.jsx(i,{variant:"secondary",type:"button",onClick:()=>a({show:!1,id:null,label:"",next:0}),children:"Huỷ"}),e.jsx(i,{variant:"primary",type:"button",onClick:async()=>{!l.id||!l.next||(await f(l.id,l.next),a({show:!1,id:null,label:"",next:0}))},children:"Xác nhận"})]})]}),e.jsxs(n,{show:t.show,onHide:()=>d({show:!1,order:null}),centered:!0,size:"lg",children:[e.jsx(n.Header,{closeButton:!0,children:e.jsxs(n.Title,{children:["Chi tiết đơn hàng #",t.order?.id]})}),e.jsx(n.Body,{children:t.order&&e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("h6",{children:"Thông tin khách hàng"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Họ tên:"})," ",t.order.customer.firstName," ",t.order.customer.lastName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Số điện thoại:"})," ",t.order.customer.phone]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"})," ",t.order.customer.email]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Địa chỉ:"})," ",t.order.customer.address]}),t.order.note&&e.jsxs("p",{children:[e.jsx("strong",{children:"Ghi chú:"})," ",t.order.note]})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("h6",{children:"Thông tin đơn hàng"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Ngày đặt:"})," ",h(t.order.createDate,"DD/MM/YYYY HH:mm")]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Ngày giao dự kiến:"})," ",h(t.order.expectDateDelivery,"DD/MM/YYYY HH:mm")]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Trạng thái:"})," ",m(t.order.status)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Phí vận chuyển:"})," ",c(t.order.shippingFee||0,{currency:"VND"})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Giảm giá:"})," ",c(t.order.discount||0,{currency:"VND"})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Tổng tiền:"})," ",c(t.order.amountTotal,{currency:"VND"})]})]}),e.jsxs("div",{className:"col-12 mt-3",children:[e.jsx("h6",{children:"Sản phẩm đặt hàng"}),e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-bordered",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Sản phẩm"}),e.jsx("th",{children:"Số lượng"}),e.jsx("th",{children:"Đơn giá"}),e.jsx("th",{children:"Thành tiền"})]})}),e.jsx("tbody",{children:t.order.lines?.map((s,r)=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("strong",{children:s.product?.name||s.name})}),e.jsx("td",{children:s.quantity}),e.jsx("td",{children:c(s.unitPrice,{currency:"VND"})}),e.jsx("td",{children:c(s.subtotal,{currency:"VND"})})]},r))})]})})]}),e.jsx("div",{className:"col-12 mt-3",children:e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-md-6 offset-md-6",children:e.jsx("table",{className:"table table-sm",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("strong",{children:"Tạm tính:"})}),e.jsx("td",{className:"text-right",children:c(t.order.amountTotal-(t.order.shippingFee||0),{currency:"VND"})})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("strong",{children:"Phí vận chuyển:"})}),e.jsx("td",{className:"text-right",children:c(t.order.shippingFee||0,{currency:"VND"})})]}),(t.order.discount||0)>0&&e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("strong",{children:"Giảm giá:"})}),e.jsxs("td",{className:"text-right text-success",children:["-",c(t.order.discount||0,{currency:"VND"})]})]}),e.jsxs("tr",{className:"table-active",children:[e.jsx("td",{children:e.jsx("strong",{children:"Tổng cộng:"})}),e.jsx("td",{className:"text-right",children:e.jsx("strong",{children:c(t.order.amountTotal,{currency:"VND"})})})]})]})})})})})]})}),e.jsx(n.Footer,{children:e.jsx(i,{variant:"secondary",onClick:()=>d({show:!1,order:null}),children:"Đóng"})})]})]})},B={title:`Hóa đơn - ${S.appName}`};function z(){return e.jsxs(e.Fragment,{children:[e.jsx(H,{children:e.jsxs("title",{children:[" ",B.title]})}),e.jsx($,{})]})}export{z as default};
