import{j as e,I as _,c as d,Q as T,p as U,f as V,n as $,o as z,t as F,v as Q}from"./index-CGSQnQu3.js";import{r as j,L as R}from"./vendor-D10guwLI.js";import{f as L}from"./format-number-DeezL_hy.js";import{C as f}from"./index-CY-1Wrg4.js";import{u as X}from"./orders-Dm4iwBlD.js";import{f as H,i as J,v as K}from"./format-string-Cee-rHUc.js";import{b as W}from"./index-BDLNoMlA.js";function Y(t,n){try{if(typeof window>"u"||!window.localStorage)return n??null;const r=window.localStorage.getItem(t);return r!==null?r:n??null}catch{return null}}function Z(t){const{item:n,onDeleteItem:r,subItem:g,plusItem:i}=t;return e.jsxs("div",{className:"cart_item",children:[e.jsxs("div",{className:"content_item",children:[e.jsx("div",{className:"item_delete_1",onClick:()=>r(),children:e.jsx("img",{src:_.delete,alt:"delete"})}),e.jsx(W.LazyLoadImage,{effect:"blur",src:n.product.image,alt:n.product.name}),e.jsxs("div",{className:"mota",children:[e.jsx("p",{className:"title_item_cart",children:n.product.name}),e.jsx("p",{className:"title_item_cart description__cart",children:H(n.product.description)})]})]}),e.jsxs("div",{className:"option_item",children:[e.jsx("img",{src:_.tru,alt:"minus",onClick:()=>g()}),e.jsx("div",{className:"quantity",children:n.quantity}),e.jsx("img",{src:_.plus,alt:"plus",onClick:()=>i()})]})]})}function ee(t){var v,b,I,C;const[n,{isLoading:r}]=X(),[g,i]=j.useState(!1),[m,u]=j.useState("container-fluid"),[o,S]=j.useState({firstName:"",lastName:"",phone:"",email:"",address:"",note:""});j.useEffect(()=>{Y("token")?i(!0):u("container")},[]);const y=(a,s,c)=>{if(c===-1&&a<=1||c===1&&a>=100)return;const{actUpdateItem:l}=t;l(s,c),d.success("Cập nhật thành công!")},h=(t==null?void 0:t.cartItem)??[],k=j.useMemo(()=>!Array.isArray(h)||h.length===0?null:h.map((a,s)=>{var l;const c=Number(a.quantity)||0;return e.jsx(Z,{item:a,onDeleteItem:()=>A(a.product.id),subItem:()=>y(c,a.product.id,-1),plusItem:()=>y(c,a.product.id,1)},`${String((l=a.product)==null?void 0:l.id)}-${s}`)}),[h]),A=a=>{if(window.confirm("Bạn muốn xoá sản phẩm này")){const{actDeleteItem:s}=t;s(a),d.success("Cập nhật thành công!"),localStorage.getItem("token")||(i(!1),u("container"))}},q=j.useMemo(()=>h.reduce((a,s)=>{var c;return a+(Number((c=s==null?void 0:s.product)==null?void 0:c.price)||0)*(Number(s==null?void 0:s.quantity)||0)},0),[h]),x=a=>{a.preventDefault();const{target:s}=a,{name:c,value:l}=s;S(p=>({...p,[c]:l}))},E=async()=>{const{firstName:a,lastName:s,email:c,address:l,phone:p,note:w}=o,{cartItem:O}=t,D=new Date;if(a===""||s===""||c===""||l===""||p===""){d.warning("Vui lòng nhập đủ thông tin của bạn!");return}if(!J(c)){d.error("Nhập đúng định dạng email!");return}if(!K(p)){d.error("Số điện thoại phải có 10-11 chữ số!");return}const B=(O||[]).map(N=>({productId:N.product.id,quantity:N.quantity,unitPrice:N.product.price,subtotal:N.product.price*N.quantity,discount:0,note:w}));try{await n({body:{data:D,expectDateDelivery:D,note:w,customer:{firstName:a,lastName:s,phone:p,email:c,address:l},lines:B}}).unwrap(),t==null||t.actDeleteAll(),i(!1),u("container"),window.location.href=U.main.successPayment}catch{d.error("Có lỗi xảy ra")}},P=()=>{t==null||t.actDeleteAll(),i(!1),u("container"),d.success("Thành công!")},M=e.jsx("div",{className:"description_cart",children:e.jsxs("div",{className:"page_empty",children:[e.jsx("img",{className:"img_empty_cart",alt:"empty",src:_.empty}),e.jsx(R,{to:"/",className:"btn_back",children:e.jsx("span",{children:"Mua thêm sản phẩm"})})]})}),G=g===!0&&e.jsxs("div",{className:"cart_custom",children:[e.jsx("div",{className:"cart_header_custom",children:e.jsx("p",{className:"content_cart",children:"Đơn hàng"})}),e.jsx("div",{className:"cart_custom_body",children:e.jsxs("div",{className:"cart_custom_detail",children:[e.jsx(f,{className:"input_custom",style:{marginLeft:20,width:"90%"},onChange:x,name:"firstName",value:o.firstName,placeholder:"Nhập họ"}),e.jsx("br",{}),e.jsx(f,{className:"input_custom",style:{marginLeft:20,width:"90%"},onChange:x,name:"lastName",value:o.lastName,placeholder:"Nhập tên"}),e.jsx("br",{}),e.jsx(f,{className:"input_custom",placeholder:"Nhập địa chỉ",style:{marginLeft:20,width:"90%"},name:"address",value:o.address,onChange:x}),e.jsx("br",{}),e.jsx(f,{className:"input_custom",style:{marginLeft:20,width:"90%"},placeholder:"Nhập số điện thoại",name:"phone",type:"tel",value:o.phone,onChange:x}),e.jsx("br",{}),e.jsx(f,{className:"input_custom",style:{marginLeft:20,width:"90%"},placeholder:"Nhập email",value:o.email,name:"email",type:"email",onChange:x}),e.jsx(f,{className:"input_custom",style:{marginLeft:20,width:"90%"},placeholder:"Nhập ghi chú nếu có",value:o.note,name:"note",onChange:x})]})}),e.jsxs("div",{className:"cart_amount_body",children:[e.jsxs("div",{className:"thongtin",children:[e.jsx("p",{children:"Giá sản phẩm (1):"}),e.jsx("p",{children:"Tổng cộng:"})]}),e.jsxs("div",{className:"thanhtoan",children:[e.jsxs("p",{children:[L(((I=(b=(v=t==null?void 0:t.cartItem)==null?void 0:v[0])==null?void 0:b.product)==null?void 0:I.price)||0)," đ"]}),e.jsxs("p",{className:"total",children:[L(q)," đ"]})]})]}),e.jsx("button",{type:"button",className:"btn_payment",onClick:E,disabled:r,children:"Đặt mua"})]});return e.jsxs("div",{className:m,children:[e.jsx(T,{autoClose:1e3}),e.jsxs("div",{className:"page_cart",children:[e.jsxs("div",{className:"card_cart",children:[e.jsxs("div",{className:"cart_header",children:[e.jsx("p",{className:"content_cart",children:"Giỏ hàng"}),e.jsxs("p",{className:"number_cart",children:[(t==null?void 0:t.cartItem.length)??0," sản phẩm"]})]}),e.jsxs("div",{className:"cart_body",children:[e.jsxs("div",{className:"option",children:[e.jsxs("div",{className:"select_all",children:[e.jsx("input",{type:"checkbox",className:"checkbox"}),e.jsx("p",{className:"text_selectAll",style:{paddingLeft:8},children:"Chọn tất cả"})]}),e.jsxs("button",{type:"button",className:"delete_item",onClick:P,children:[e.jsx("img",{src:_.delete,alt:"delete"}),e.jsx("p",{className:"text_delete",children:"Xoá tất cả"})]})]}),e.jsx("div",{className:"content_cart_item",children:(C=t==null?void 0:t.cartItem)!=null&&C.length?k:M})]})]}),G]})]})}function ie(){const t=V(),n=$(m=>m.cart),r=(m,u)=>{t(z({id:m,quantities:u}))},g=m=>{t(F({id:m}))},i=()=>{t(Q())};return e.jsx(ee,{cartItem:n,actUpdateItem:r,actDeleteItem:g,actDeleteAll:i})}export{ie as default};
