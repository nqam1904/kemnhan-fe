import{l as ee,j as t,m as z,x as He,y as Pe,z as Xe,D as fe,E as We,A as pe,T as ze,F as Ve,r as Y,I as J,B as _,Q as Ge,c as X,H as Ke,d as Qe}from"./index-Cisqq87o.js";import{a as ge,f as xe}from"./format-time-Di1EMY9f.js";import{e as qe}from"./index.es-3P-hqikk.js";import{c as Ye}from"./styles-Bw6Lb06x.js";import{r}from"./vendor-D10guwLI.js";import{u as Je,a as Ze,b as we}from"./carousel-Dc-ScXZG.js";import{u as et,M as W}from"./Modal-BE1P8Ww6.js";import{f as tt,m as ye,F as Z}from"./Form-B4CIVEzx.js";import"./dayjs.min-DmYrFLVn.js";function nt(n,i){const l=r.useRef(!0);r.useEffect(()=>{if(l.current){l.current=!1;return}return n()},i)}function st(){const n=r.useRef(!0),i=r.useRef(()=>n.current);return r.useEffect(()=>(n.current=!0,()=>{n.current=!1}),[]),i.current}const w=2**31-1;function be(n,i,l){const d=l-Date.now();n.current=d<=w?setTimeout(i,d):setTimeout(()=>be(n,i,l),w)}function at(){const n=st(),i=r.useRef();return et(()=>clearTimeout(i.current)),r.useMemo(()=>{const l=()=>clearTimeout(i.current);function d(u,h=0){n()&&(l(),h<=w?i.current=setTimeout(u,h):be(i,u,Date.now()+h))}return{set:d,clear:l,handleRef:i}},[])}const je=r.forwardRef(({className:n,bsPrefix:i,as:l="div",...d},u)=>(i=ee(i,"carousel-caption"),t.jsx(l,{ref:u,className:z(n,i),...d})));je.displayName="CarouselCaption";const Ce=r.forwardRef(({as:n="div",bsPrefix:i,className:l,...d},u)=>{const h=z(l,ee(i,"carousel-item"));return t.jsx(n,{ref:u,...d,className:h})});Ce.displayName="CarouselItem";const rt=40;function lt(n){if(!n||!n.style||!n.parentNode||!n.parentNode.style)return!1;const i=getComputedStyle(n);return i.display!=="none"&&i.visibility!=="hidden"&&getComputedStyle(n.parentNode).display!=="none"}const Ne=r.forwardRef(({defaultActiveIndex:n=0,...i},l)=>{const{as:d="div",bsPrefix:u,slide:h=!0,fade:S=!1,controls:R=!0,indicators:E=!0,indicatorLabels:T=[],activeIndex:x,onSelect:p,onSlide:y,onSlid:v,interval:b=5e3,keyboard:j=!0,onKeyDown:$,pause:D="hover",onMouseOver:B,onMouseOut:O,wrap:e=!0,touch:s=!0,onTouchStart:c,onTouchMove:m,onTouchEnd:g,prevIcon:H=t.jsx("span",{"aria-hidden":"true",className:"carousel-control-prev-icon"}),prevLabel:te="Previous",nextIcon:Re=t.jsx("span",{"aria-hidden":"true",className:"carousel-control-next-icon"}),nextLabel:ne="Next",variant:se,className:Te,children:K,...ke}=He({defaultActiveIndex:n,...i},{activeIndex:"onSelect"}),k=ee(u,"carousel"),A=Pe(),F=r.useRef(null),[ae,re]=r.useState("next"),[Ie,V]=r.useState(!1),[U,le]=r.useState(!1),[f,Se]=r.useState(x||0);r.useEffect(()=>{!U&&x!==f&&(F.current?re(F.current):re((x||0)>f?"next":"prev"),h&&le(!0),Se(x||0))},[x,U,f,h]),r.useEffect(()=>{F.current&&(F.current=null)});let M=0,ie;tt(K,(a,o)=>{++M,o===x&&(ie=a.props.interval)});const ce=Xe(ie),C=r.useCallback(a=>{if(U)return;let o=f-1;if(o<0){if(!e)return;o=M-1}F.current="prev",p==null||p(o,a)},[U,f,p,e,M]),N=fe(a=>{if(U)return;let o=f+1;if(o>=M){if(!e)return;o=0}F.current="next",p==null||p(o,a)}),Q=r.useRef();r.useImperativeHandle(l,()=>({element:Q.current,prev:C,next:N}));const oe=fe(()=>{!document.hidden&&lt(Q.current)&&(A?C():N())}),L=ae==="next"?"start":"end";nt(()=>{h||(y==null||y(f,L),v==null||v(f,L))},[f]);const Ee=`${k}-item-${ae}`,De=`${k}-item-${L}`,$e=r.useCallback(a=>{We(a),y==null||y(f,L)},[y,f,L]),Me=r.useCallback(()=>{le(!1),v==null||v(f,L)},[v,f,L]),Le=r.useCallback(a=>{if(j&&!/input|textarea/i.test(a.target.tagName))switch(a.key){case"ArrowLeft":a.preventDefault(),A?N(a):C(a);return;case"ArrowRight":a.preventDefault(),A?C(a):N(a);return}$==null||$(a)},[j,$,C,N,A]),Ae=r.useCallback(a=>{D==="hover"&&V(!0),B==null||B(a)},[D,B]),Fe=r.useCallback(a=>{V(!1),O==null||O(a)},[O]),ue=r.useRef(0),G=r.useRef(0),de=at(),Ue=r.useCallback(a=>{ue.current=a.touches[0].clientX,G.current=0,D==="hover"&&V(!0),c==null||c(a)},[D,c]),_e=r.useCallback(a=>{a.touches&&a.touches.length>1?G.current=0:G.current=a.touches[0].clientX-ue.current,m==null||m(a)},[m]),Be=r.useCallback(a=>{if(s){const o=G.current;Math.abs(o)>rt&&(o>0?C(a):N(a))}D==="hover"&&de.set(()=>{V(!1)},b||void 0),g==null||g(a)},[s,D,C,N,de,b,g]),me=b!=null&&!Ie&&!U,q=r.useRef();r.useEffect(()=>{var a,o;if(!me)return;const I=A?C:N;return q.current=window.setInterval(document.visibilityState?oe:I,(a=(o=ce.current)!=null?o:b)!=null?a:void 0),()=>{q.current!==null&&clearInterval(q.current)}},[me,C,N,ce,b,oe,A]);const he=r.useMemo(()=>E&&Array.from({length:M},(a,o)=>I=>{p==null||p(o,I)}),[E,M,p]);return t.jsxs(d,{ref:Q,...ke,onKeyDown:Le,onMouseOver:Ae,onMouseOut:Fe,onTouchStart:Ue,onTouchMove:_e,onTouchEnd:Be,className:z(Te,k,h&&"slide",S&&`${k}-fade`,se&&`${k}-${se}`),children:[E&&t.jsx("div",{className:`${k}-indicators`,children:ye(K,(a,o)=>t.jsx("button",{type:"button","data-bs-target":"","aria-label":T!=null&&T.length?T[o]:`Slide ${o+1}`,className:o===f?"active":void 0,onClick:he?he[o]:void 0,"aria-current":o===f},o))}),t.jsx("div",{className:`${k}-inner`,children:ye(K,(a,o)=>{const I=o===f;return h?t.jsx(ze,{in:I,onEnter:I?$e:void 0,onEntered:I?Me:void 0,addEndListener:Ve,children:(P,Oe)=>r.cloneElement(a,{...Oe,className:z(a.props.className,I&&P!=="entered"&&Ee,(P==="entered"||P==="exiting")&&"active",(P==="entering"||P==="exiting")&&De)})}):r.cloneElement(a,{className:z(a.props.className,I&&"active")})})}),R&&t.jsxs(t.Fragment,{children:[(e||x!==0)&&t.jsxs(pe,{className:`${k}-control-prev`,onClick:C,children:[H,te&&t.jsx("span",{className:"visually-hidden",children:te})]}),(e||x!==M-1)&&t.jsxs(pe,{className:`${k}-control-next`,onClick:N,children:[Re,ne&&t.jsx("span",{className:"visually-hidden",children:ne})]})]})]})});Ne.displayName="Carousel";const ve=Object.assign(Ne,{Caption:je,Item:Ce}),it={maxWidth:1920,maxHeight:1080,quality:.8,mimeType:"image/jpeg",thresholdBytes:1024*1024};function ct(n,i,l,d){const u=Math.min(l/n,d/i,1);return{width:Math.round(n*u),height:Math.round(i*u)}}async function ot(n,i){const l={...it};if(!n||!n.type.startsWith("image/")||n.size<=l.thresholdBytes)return n;const d=URL.createObjectURL(n);try{const u=await new Promise((v,b)=>{const j=new Image;j.onload=()=>v(j),j.onerror=$=>b($),j.src=d}),{width:h,height:S}=ct(u.naturalWidth||u.width,u.naturalHeight||u.height,l.maxWidth,l.maxHeight),R=document.createElement("canvas");R.width=h,R.height=S;const E=R.getContext("2d");if(!E)return n;E.drawImage(u,0,0,h,S);const T=await new Promise(v=>R.toBlob(b=>v(b),l.mimeType,l.quality));if(!T||T.size>=n.size)return n;const x=l.mimeType==="image/png"?"png":l.mimeType==="image/webp"?"webp":"jpg",p=n.name.replace(/\.[^/.]+$/,"");return new File([T],`${p}.compressed.${x}`,{type:l.mimeType,lastModified:Date.now()})}catch{return n}finally{URL.revokeObjectURL(d)}}async function ut(n,i){return Promise.all(n.map(l=>ot(l)))}const dt=()=>{const[n,i]=r.useState([]),[l,d]=r.useState([]),[u,h]=r.useState(!1),{data:S=[],refetch:R}=Je(),[E]=Ze(),[T]=we(),[x,p]=r.useState(!1),y=r.useRef(null),v=e=>{const s=e.target.files,c=s?Array.from(s):[];i(c);const m=c.map(g=>URL.createObjectURL(g));d(m)},b=e=>{const s=l[e];try{URL.revokeObjectURL(s)}catch(g){console.log(g)}const c=l.filter((g,H)=>H!==e),m=n.filter((g,H)=>H!==e);d(c),i(m),m.length===0&&y.current&&(y.current.value="")},j=()=>{l.forEach(e=>{try{URL.revokeObjectURL(e)}catch(s){console.log(s)}}),i([]),d([]),y.current&&(y.current.value="")},$=async()=>{if(!n.length){X.warning("Vui lòng chọn hình ảnh!");return}try{h(!0);const e=await ut(n);await Promise.all(e.map(s=>{const c=new FormData;return c.append("name",`Banner ${s.name}`),c.append("isActive","true"),c.append("image",s),E({body:c}).unwrap()})),X.success("Lưu carousel thành công!"),p(!1),j(),R()}catch{X.error("Có lỗi xảy ra")}finally{h(!1)}},D=async e=>{if(window.confirm("Bạn có chắc muốn xoá banner này?"))try{await T({id:e}).unwrap(),X.success("Xoá thành công"),R()}catch{X.error("Có lỗi xảy ra")}},B=r.useMemo(()=>{const e=l.length?l:(S||[]).map(s=>{var c,m,g;return((c=s==null?void 0:s.image)==null?void 0:c.url)||((m=s==null?void 0:s.image)!=null&&m.key?Y((g=s==null?void 0:s.image)==null?void 0:g.key):"")}).filter(s=>!!s);return e.length?t.jsx("div",{style:{maxWidth:1920,margin:"0 auto"},children:t.jsx(ve,{interval:2e3,indicators:!0,pause:!1,slide:!1,children:e.map((s,c)=>t.jsx(ve.Item,{children:t.jsx("img",{src:s,alt:`banner-${c}`,style:{width:"100%",height:"auto",aspectRatio:"1920 / 700",objectFit:"cover",borderRadius:8},onError:m=>{try{m.currentTarget.style.display="none"}catch(g){console.log(g)}}})},`${s}-${c}`))})}):null},[l,S]),O=r.useMemo(()=>[{name:"Vị trí",selector:(e,s)=>String((s??0)+1),width:"80px"},{name:"Hình ảnh",selector:e=>{var s,c;return((s=e==null?void 0:e.image)==null?void 0:s.key)||((c=e==null?void 0:e.image)==null?void 0:c.url)||""},cell:e=>{var c,m;const s=((c=e==null?void 0:e.image)==null?void 0:c.url)||Y(((m=e==null?void 0:e.image)==null?void 0:m.key)||"");return t.jsx("img",{src:s||J.image,alt:(e==null?void 0:e.name)||"banner",width:140,height:90,style:{objectFit:"cover",borderRadius:6}})},width:"220px"},{name:"Link",selector:e=>{var s,c;return((s=e==null?void 0:e.image)==null?void 0:s.key)||((c=e==null?void 0:e.image)==null?void 0:c.url)||""},cell:e=>{var c,m;const s=((c=e==null?void 0:e.image)==null?void 0:c.url)||Y(((m=e==null?void 0:e.image)==null?void 0:m.key)||"");return s?t.jsx("a",{href:s,target:"_blank",rel:"noreferrer","aria-label":"Xem",children:t.jsx("img",{src:J.icEye,alt:"view",width:18,height:18})}):null},width:"120px"},{name:"Ngày tạo",selector:e=>(e==null?void 0:e.createDate)||(e==null?void 0:e.createdAt)||"",cell:e=>`${ge((e==null?void 0:e.createDate)||(e==null?void 0:e.createdAt))} ${xe((e==null?void 0:e.createDate)||(e==null?void 0:e.createdAt))}`},{name:"Ngày cập nhật",selector:e=>(e==null?void 0:e.writeDate)||(e==null?void 0:e.updatedAt)||"",cell:e=>`${ge((e==null?void 0:e.writeDate)||(e==null?void 0:e.updatedAt))} ${xe((e==null?void 0:e.writeDate)||(e==null?void 0:e.updatedAt))}`},{name:"Chức năng",selector:e=>e==null?void 0:e.id,cell:e=>t.jsxs(t.Fragment,{children:[t.jsx(_,{type:"button",className:"btn btn-warning white mr-10",onClick:()=>{},children:"Sửa"}),t.jsx(_,{type:"button",className:"btn btn-danger white",onClick:()=>D(e.id),children:"Xóa"})]}),width:"180px"}],[]);return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-10 mb-3",children:[t.jsx("h1",{className:"m-0",children:"Quản lý Banner"}),t.jsx(_,{onClick:()=>p(!0),children:"Thêm"})]}),t.jsx(Ge,{autoClose:1e3}),t.jsx(qe,{title:"",columns:O,data:S,pagination:!0,responsive:!0,dense:!0,customStyles:Ye}),t.jsxs(W,{show:x,onHide:()=>p(!1),centered:!0,size:"lg",children:[t.jsx(W.Header,{closeButton:!0,children:t.jsx(W.Title,{children:"Thêm banner"})}),t.jsxs(W.Body,{children:[t.jsx("div",{className:"mb-3",children:t.jsxs(Z.Group,{controlId:"banner-upload",children:[t.jsx(Z.Label,{children:"Chọn ảnh banner"}),t.jsx(Z.Control,{ref:y,type:"file",onChange:v})]})}),l.length>0?t.jsx("div",{className:"mb-3",children:t.jsx("div",{className:"d-flex flex-wrap",children:l.map((e,s)=>t.jsxs("div",{style:{position:"relative",padding:8},children:[t.jsx("img",{src:e,alt:`preview-${s}`,width:140,height:90,style:{objectFit:"cover",borderRadius:6}}),t.jsx(_,{variant:"link",className:"p-0",style:{position:"absolute",top:2,right:2},onClick:()=>b(s),"aria-label":"Remove",children:t.jsx("img",{src:J.ic_clear,alt:"clear",width:18,height:18})})]},`${e}-${s}`))})}):null]}),t.jsxs(W.Footer,{children:[t.jsx(_,{variant:"secondary",onClick:j,disabled:!n.length,children:"Xoá tất cả"}),t.jsx(_,{type:"button",className:"btn btn-primary",onClick:$,disabled:u||!n.length,children:"Lưu banner"})]})]}),t.jsx("div",{className:"mt-4",children:B})]})},mt={title:`Banner - ${Qe.appName}`};function Ct(){return t.jsxs(t.Fragment,{children:[t.jsx(Ke,{children:t.jsxs("title",{children:[" ",mt.title]})}),t.jsx(dt,{})]})}export{Ct as default};
