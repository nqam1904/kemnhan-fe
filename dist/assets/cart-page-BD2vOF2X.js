import{j as e,I as N,r as l,Q as B,c as d,g as F,f as M,L as z,h as O,n as Q,o as R,p as X,t as H}from"./index-CvJx62Zl.js";import{f as w}from"./format-number-DeezL_hy.js";import{C as h}from"./index-BGV0FIID.js";import{f as J,i as K,v as W}from"./format-string-Cee-rHUc.js";import{b as Y}from"./index-CaOnp5oM.js";function Z(t){const{item:i,onDeleteItem:m,subItem:x,plusItem:o}=t;return e.jsxs("div",{className:"cart_item",children:[e.jsxs("div",{className:"content_item",children:[e.jsx("div",{className:"item_delete_1",onClick:()=>m(),children:e.jsx("img",{src:N.delete,alt:"delete"})}),e.jsx(Y.LazyLoadImage,{effect:"blur",src:i.product.image,alt:i.product.name}),e.jsxs("div",{className:"mota",children:[e.jsx("p",{className:"title_item_cart",children:i.product.name}),e.jsx("p",{className:"title_item_cart description__cart",children:J(i.product.description)})]})]}),e.jsxs("div",{className:"option_item",children:[e.jsx("img",{src:N.tru,alt:"minus",onClick:()=>x()}),e.jsx("div",{className:"quantity",children:i.quantity}),e.jsx("img",{src:N.plus,alt:"plus",onClick:()=>o()})]})]})}function ee(t){var I,b,C;const[i,m]=l.useState(!1),[x,o]=l.useState("container-fluid"),[r,g]=l.useState(""),[_,D]=l.useState(""),[j,k]=l.useState(""),[f,L]=l.useState(""),[p,A]=l.useState(""),[y,q]=l.useState("");l.useEffect(()=>{localStorage.getItem("token")?m(!0):o("container")},[]);const v=(n,c,a)=>{if(a===-1&&n<=1||a===1&&n>=100)return;const{actUpdateItem:s}=t;s(c,a),d.success("Cập nhật thành công!")},E=()=>{const{cartItem:n}=t;return!Array.isArray(n)||n.length===0?null:n.map((c,a)=>{var S;const s=Number(c.quantity)||0;return e.jsx(Z,{item:c,onDeleteItem:()=>P(c.product.id),subItem:()=>v(s,c.product.id,-1),plusItem:()=>v(s,c.product.id,1)},`${String((S=c.product)==null?void 0:S.id)}-${a}`)})},P=n=>{if(window.confirm("Bạn muốn xoá sản phẩm này")){const{actDeleteItem:c}=t;c(n),d.success("Cập nhật thành công!"),localStorage.getItem("token")||(m(!1),o("container"))}},G=l.useMemo(()=>((t==null?void 0:t.cartItem)??[]).reduce((c,a)=>{var s;return c+(Number((s=a==null?void 0:a.product)==null?void 0:s.price)||0)*(Number(a==null?void 0:a.quantity)||0)},0),[t==null?void 0:t.cartItem]),u=n=>{n.preventDefault();const{target:c}=n,{name:a}=c,{value:s}=c;a==="firstName"?g(s):a==="lastName"?D(s):a==="address"?A(s):a==="phone"?k(s):a==="email"?L(s):a==="note"&&q(s)},T=()=>{const{cartItem:n}=t,c=new Date;if(r===""||_===""||f===""||p===""||j===""){d.warning("Vui lòng nhập đủ thông tin của bạn!");return}if(!K(f)){d.error("Nhập đúng định dạng email!");return}if(!W(j)){d.error("Số điện thoại phải có 10-11 chữ số!");return}const a=(n||[]).map(s=>({productId:s.product.id,quantity:s.quantity,unitPrice:s.product.price,subtotal:s.product.price*s.quantity,discount:0,note:y}));F.post(`${M.serverUrl}/orders`,{data:c,expectDateDelivery:c,note:y,customer:{firstName:r,lastName:_,phone:j,email:f,address:p},lines:a}).then(s=>{t==null||t.actDeleteAll(),m(!1),o("container"),window.location.href="/SuccessPayment"}).catch(s=>{d.error("Có lỗi xảy ra")})},U=()=>{localStorage.getItem("token")&&(t==null||t.actDeleteAll(),m(!1),o("container"),d.success("Thành công!"))},V=e.jsx("div",{className:"description_cart",children:e.jsxs("div",{className:"page_empty",children:[e.jsx("img",{className:"img_empty_cart",alt:"empty",src:N.empty}),e.jsx(z,{to:"/",className:"btn_back",children:e.jsx("span",{children:"Mua thêm sản phẩm"})})]})}),$=i===!0&&e.jsxs("div",{className:"cart_custom",children:[e.jsx("div",{className:"cart_header_custom",children:e.jsx("p",{className:"content_cart",children:"Đơn hàng"})}),e.jsx("div",{className:"cart_custom_body",children:e.jsxs("div",{className:"cart_custom_detail",children:[e.jsx(h,{className:"input_custom",style:{marginLeft:20,width:"90%"},onChange:u,name:"firstName",value:r,placeholder:"Nhập họ"})," ",e.jsx("br",{}),e.jsx(h,{className:"input_custom",style:{marginLeft:20,width:"90%"},onChange:u,name:"lastName",value:_,placeholder:"Nhập tên"})," ",e.jsx("br",{}),e.jsx(h,{className:"input_custom",placeholder:"Nhập địa chỉ",style:{marginLeft:20,width:"90%"},name:"address",value:p,onChange:u}),e.jsx("br",{}),e.jsx(h,{className:"input_custom",style:{marginLeft:20,width:"90%"},placeholder:"Nhập số điện thoại",name:"phone",type:"tel",value:j,onChange:u}),e.jsx("br",{}),e.jsx(h,{className:"input_custom",style:{marginLeft:20,width:"90%"},placeholder:"Nhập email",value:f,name:"email",type:"email",onChange:u}),e.jsx(h,{className:"input_custom",style:{marginLeft:20,width:"90%"},placeholder:"Nhập ghi chú nếu có",value:y,name:"note",onChange:u})]})}),e.jsxs("div",{className:"cart_amount_body",children:[e.jsxs("div",{className:"thongtin",children:[e.jsx("p",{children:"Giá sản phẩm (1):"}),e.jsx("p",{children:"Tổng cộng:"})]}),e.jsxs("div",{className:"thanhtoan",children:[e.jsxs("p",{children:[w(((C=(b=(I=t==null?void 0:t.cartItem)==null?void 0:I[0])==null?void 0:b.product)==null?void 0:C.price)||0)," đ"]}),e.jsxs("p",{className:"total",children:[w(G)," đ"]})]})]}),e.jsx("button",{type:"button",className:"btn_payment",onClick:T,children:"Đặt mua"})]});return e.jsxs("div",{className:x,children:[e.jsx(B,{autoClose:1e3}),e.jsxs("div",{className:"page_cart",children:[e.jsxs("div",{className:"card_cart",children:[e.jsxs("div",{className:"cart_header",children:[e.jsx("p",{className:"content_cart",children:"Giỏ hàng"}),e.jsxs("p",{className:"number_cart",children:[(t==null?void 0:t.cartItem.length)??0," Sản phẩm"]})]}),e.jsxs("div",{className:"cart_body",children:[e.jsxs("div",{className:"option",children:[e.jsxs("div",{className:"select_all",children:[e.jsx("input",{type:"checkbox",className:"checkbox"}),e.jsx("p",{className:"text_selectAll",style:{paddingLeft:8},children:"Chọn tất cả"})]}),e.jsxs("button",{type:"button",className:"delete_item",onClick:U,children:[e.jsx("img",{src:N.delete,alt:"delete"}),e.jsx("p",{className:"text_delete",children:"Xoá Tất cả"})]})]}),e.jsx("div",{className:"content_cart_item",children:localStorage.getItem("token")?E():V})]})]}),$]})]})}function le(){const t=O(),i=Q(r=>r.cart),m=(r,g)=>{t(R({id:r,quantityDelta:g}))},x=r=>{t(X({id:r}))},o=()=>{t(H())};return e.jsx(ee,{cartItem:i,actUpdateItem:m,actDeleteItem:x,actDeleteAll:o})}export{le as default};
