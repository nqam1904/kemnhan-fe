import{R as _,e as C,j as t,r as A,I as L,B as g,Q as q,c as R,H as P,d as z}from"./index-CGSQnQu3.js";import{a as B,f as D}from"./format-time-Di1EMY9f.js";import{e as H}from"./index.es-BVU3MIBu.js";import{c as O}from"./styles-Bw6Lb06x.js";import{r as d}from"./vendor-D10guwLI.js";import{C as I}from"./Carousel-CO62Y_Hz.js";import{M as $}from"./Modal-uUVsHhbb.js";import{F as N}from"./Form-DYuaszbI.js";import"./dayjs.min-DmYrFLVn.js";import"./ElementChildren-DQADstU7.js";const G={maxWidth:1920,maxHeight:1080,quality:.8,mimeType:"image/jpeg",thresholdBytes:1024*1024};function Q(s,l,i,m){const c=Math.min(i/s,m/l,1);return{width:Math.round(s*c),height:Math.round(l*c)}}async function W(s,l){const i={...G};if(!s||!s.type.startsWith("image/")||s.size<=i.thresholdBytes)return s;const m=URL.createObjectURL(s);try{const c=await new Promise((f,b)=>{const o=new Image;o.onload=()=>f(o),o.onerror=k=>b(k),o.src=m}),{width:y,height:h}=Q(c.naturalWidth||c.width,c.naturalHeight||c.height,i.maxWidth,i.maxHeight),u=document.createElement("canvas");u.width=y,u.height=h;const T=u.getContext("2d");if(!T)return s;T.drawImage(c,0,0,y,h);const x=await new Promise(f=>u.toBlob(b=>f(b),i.mimeType,i.quality));if(!x||x.size>=s.size)return s;const U=i.mimeType==="image/png"?"png":i.mimeType==="image/webp"?"webp":"jpg",j=s.name.replace(/\.[^/.]+$/,"");return new File([x],`${j}.compressed.${U}`,{type:i.mimeType,lastModified:Date.now()})}catch{return s}finally{URL.revokeObjectURL(m)}}async function X(s,l){return Promise.all(s.map(i=>W(i)))}const V=_.injectEndpoints({endpoints:s=>({getCarousels:s.query({query:()=>({url:C.dashboard.carousels,method:"GET"})}),getCarousel:s.query({query:l=>({url:`${C.dashboard.carousels}/${l}`,method:"GET"})}),createCarousel:s.mutation({query:({body:l})=>({url:C.dashboard.carousels,method:"POST",body:l})}),updateCarousel:s.mutation({query:({id:l,body:i})=>({url:`${C.dashboard.carousels}/${l}`,method:"PUT",body:i})}),deleteCarousel:s.mutation({query:({id:l})=>({url:`${C.dashboard.carousels}/${l}`,method:"DELETE"})})})}),{useGetCarouselsQuery:K,useGetCarouselQuery:ue,useCreateCarouselMutation:J,useUpdateCarouselMutation:oe,useDeleteCarouselMutation:Y}=V,Z=()=>{const[s,l]=d.useState([]),[i,m]=d.useState([]),[c,y]=d.useState(!1),{data:h=[],refetch:u}=K(),[T]=J(),[x]=Y(),[U,j]=d.useState(!1),p=d.useRef(null),f=e=>{const a=e.target.files,n=a?Array.from(a):[];l(n);const r=n.map(v=>URL.createObjectURL(v));m(r)},b=e=>{const a=i[e];try{URL.revokeObjectURL(a)}catch(v){console.log(v)}const n=i.filter((v,F)=>F!==e),r=s.filter((v,F)=>F!==e);m(n),l(r),r.length===0&&p.current&&(p.current.value="")},o=()=>{i.forEach(e=>{try{URL.revokeObjectURL(e)}catch(a){console.log(a)}}),l([]),m([]),p.current&&(p.current.value="")},k=async()=>{if(!s.length){R.warning("Vui lòng chọn hình ảnh!");return}try{y(!0);const e=await X(s);await Promise.all(e.map(a=>{const n=new FormData;return n.append("name",`Banner ${a.name}`),n.append("isActive","true"),n.append("image",a),T({body:n}).unwrap()})),R.success("Lưu carousel thành công!"),j(!1),o(),u()}catch{R.error("Có lỗi xảy ra")}finally{y(!1)}},E=async e=>{if(window.confirm("Bạn có chắc muốn xoá banner này?"))try{await x({id:e}).unwrap(),R.success("Xoá thành công"),u()}catch{R.error("Có lỗi xảy ra")}},M=d.useMemo(()=>{const e=i.length?i:(h||[]).map(a=>{var n,r;return((n=a==null?void 0:a.image)==null?void 0:n.url)||((r=a==null?void 0:a.image)==null?void 0:r.key)}).filter(Boolean);return e.length?t.jsx("div",{style:{maxWidth:1920,margin:"0 auto"},children:t.jsx(I,{interval:2e3,indicators:!0,pause:!1,slide:!1,children:e.map((a,n)=>t.jsx(I.Item,{children:t.jsx("img",{src:a,alt:`banner-${n}`,style:{width:"100%",height:"auto",aspectRatio:"1920 / 700",objectFit:"cover",borderRadius:8}})},`${a}-${n}`))})}):null},[i,h]),S=d.useMemo(()=>[{name:"Vị trí",selector:(e,a)=>String((a??0)+1),width:"80px"},{name:"Hình ảnh",selector:e=>{var a,n;return((a=e==null?void 0:e.image)==null?void 0:a.key)||((n=e==null?void 0:e.image)==null?void 0:n.url)||""},cell:e=>{var n,r;const a=((n=e==null?void 0:e.image)==null?void 0:n.url)||A(((r=e==null?void 0:e.image)==null?void 0:r.key)||"");return t.jsx("img",{src:a||L.image,alt:(e==null?void 0:e.name)||"banner",width:140,height:90,style:{objectFit:"cover",borderRadius:6}})},width:"220px"},{name:"Link",selector:e=>{var a,n;return((a=e==null?void 0:e.image)==null?void 0:a.key)||((n=e==null?void 0:e.image)==null?void 0:n.url)||""},cell:e=>{var n,r;const a=((n=e==null?void 0:e.image)==null?void 0:n.url)||A(((r=e==null?void 0:e.image)==null?void 0:r.key)||"");return a?t.jsx("a",{href:a,target:"_blank",rel:"noreferrer","aria-label":"Xem",children:t.jsx("img",{src:L.icEye,alt:"view",width:18,height:18})}):null},width:"120px"},{name:"Ngày tạo",selector:e=>(e==null?void 0:e.createDate)||(e==null?void 0:e.createdAt)||"",cell:e=>`${B((e==null?void 0:e.createDate)||(e==null?void 0:e.createdAt))} ${D((e==null?void 0:e.createDate)||(e==null?void 0:e.createdAt))}`},{name:"Ngày cập nhật",selector:e=>(e==null?void 0:e.writeDate)||(e==null?void 0:e.updatedAt)||"",cell:e=>`${B((e==null?void 0:e.writeDate)||(e==null?void 0:e.updatedAt))} ${D((e==null?void 0:e.writeDate)||(e==null?void 0:e.updatedAt))}`},{name:"Chức năng",selector:e=>e==null?void 0:e.id,cell:e=>t.jsxs(t.Fragment,{children:[t.jsx(g,{variant:"outline-secondary",size:"sm",className:"mr-2",disabled:!0,children:"✏️"}),t.jsx(g,{variant:"outline-danger",size:"sm",onClick:()=>E(e.id),children:"Xóa"})]}),width:"180px"}],[]);return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-10 mb-3",children:[t.jsx("h1",{className:"m-0",children:"Quản lý Banner"}),t.jsx(g,{onClick:()=>j(!0),children:"Thêm"})]}),t.jsx(q,{autoClose:1e3}),t.jsx(H,{title:"",columns:S,data:h,pagination:!0,responsive:!0,dense:!0,customStyles:O}),t.jsxs($,{show:U,onHide:()=>j(!1),centered:!0,size:"lg",children:[t.jsx($.Header,{closeButton:!0,children:t.jsx($.Title,{children:"Thêm banner"})}),t.jsxs($.Body,{children:[t.jsx("div",{className:"mb-3",children:t.jsxs(N.Group,{controlId:"banner-upload",children:[t.jsx(N.Label,{children:"Chọn ảnh banner (có thể chọn nhiều ảnh)"}),t.jsx(N.Control,{ref:p,type:"file",multiple:!0,onChange:f})]})}),i.length>0?t.jsx("div",{className:"mb-3",children:t.jsx("div",{className:"d-flex flex-wrap",children:i.map((e,a)=>t.jsxs("div",{style:{position:"relative",padding:8},children:[t.jsx("img",{src:e,alt:`preview-${a}`,width:140,height:90,style:{objectFit:"cover",borderRadius:6}}),t.jsx(g,{variant:"link",className:"p-0",style:{position:"absolute",top:2,right:2},onClick:()=>b(a),"aria-label":"Remove",children:t.jsx("img",{src:L.ic_clear,alt:"clear",width:18,height:18})})]},`${e}-${a}`))})}):null]}),t.jsxs($.Footer,{children:[t.jsx(g,{variant:"secondary",onClick:o,disabled:!s.length,children:"Xoá tất cả"}),t.jsx(g,{type:"button",className:"btn btn-primary",onClick:k,disabled:c||!s.length,children:"Lưu banner"})]})]}),t.jsx("div",{className:"mt-4",children:M})]})},w={title:`Banner - ${z.appName}`};function de(){return t.jsxs(t.Fragment,{children:[t.jsx(P,{children:t.jsxs("title",{children:[" ",w.title]})}),t.jsx(Z,{})]})}export{de as default};
