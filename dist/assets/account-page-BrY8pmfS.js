import{R as Q,e as v,j as e,B as d,Q as z,I as L,w as K,c as j,H as J,d as W}from"./index-Cisqq87o.js";import{f as P}from"./format-time-Di1EMY9f.js";import{e as Z}from"./index.es-3P-hqikk.js";import{C as y}from"./index-8_4KzXG3.js";import{r as o}from"./vendor-D10guwLI.js";import{c as ee}from"./styles-Bw6Lb06x.js";import{M as n}from"./Modal-BE1P8Ww6.js";import{F as B}from"./Form-B4CIVEzx.js";import{o as se,s as m,u as te,l as ae}from"./types-BvcOK83k.js";import"./dayjs.min-DmYrFLVn.js";const re=Q.injectEndpoints({endpoints:h=>({getListUser:h.query({query:()=>({url:`${v.dashboard.account}`,method:"GET"})}),createUser:h.mutation({query:({body:i})=>({url:`${v.dashboard.account}`,method:"POST",body:i})}),updateUser:h.mutation({query:({id:i,body:w})=>({url:`${v.dashboard.account}/${i}`,method:"PUT",body:w})}),deleteUser:h.mutation({query:({id:i})=>({url:`${v.dashboard.account}/${i}`,method:"DELETE"})})})}),{useLazyGetListUserQuery:ne,useCreateUserMutation:le,useUpdateUserMutation:oe,useDeleteUserMutation:ie}=re,ce=()=>{const[h,{isLoading:i}]=ne(),[w]=le(),[Y]=oe(),[_]=ie(),[I,V]=o.useState([]),[A,x]=o.useState(!1),[O,T]=o.useState(""),[b,S]=o.useState(!1),[f,g]=o.useState({show:!1,id:null,label:""}),M={id:null,firstName:"",lastName:"",phone:"",password:"",email:"",role:""},[r,k]=o.useState(M),[t,N]=o.useState({}),$=se({firstName:m().min(1,"Vui lòng nhập họ"),lastName:m().min(1,"Vui lòng nhập tên"),phone:m().min(10,"Số điện thoại phải có 10-11 chữ số"),password:te([ae(""),m().min(6,"Mật khẩu tối thiểu 6 ký tự")]).optional(),email:m().email("Nhập đúng định dạng email"),role:m().min(1,"Vui lòng chọn chức vụ")}),C=async()=>{try{const s=await h().unwrap();V(s||[])}catch(s){console.log(s,"error")}};o.useLayoutEffect(()=>{C()},[]);const E=s=>{k({id:s.id??null,firstName:s.firstName||"",lastName:s.lastName||"",phone:s.phone||"",password:"",email:s.email||"",role:s.role||""}),T("Sửa tài khoản"),S(!1),x(!0)},U=async s=>{try{await _({id:s}).unwrap(),j.success("Xóa thành công"),C()}catch(a){j.error(`${a}`)}},R=s=>{const p=`${s.firstName||""} ${s.lastName||""}`.trim()||s.email||`#${s.id}`;g({show:!0,id:s.id,label:p})},X=o.useMemo(()=>[{name:"#",selector:"id",sortable:!0},{name:"Họ",selector:"firstName",sortable:!0},{name:"Tên",selector:"lastName",sortable:!0},{name:"Số điện thoại",selector:"phone",sortable:!0,right:!0},{name:"Email",selector:"email",sortable:!0,right:!0},{name:"Chức vụ ",selector:"role",sortable:!0,right:!0},{name:"Ngày tạo",selector:"createDate",sortable:!0,right:!0,cell:s=>e.jsx("span",{children:P(s.createDate,"DD/MM/YYYY")})},{name:"Ngày chỉnh sửa",selector:"writeDate",sortable:!0,right:!0,cell:s=>e.jsx("span",{children:P(s.writeDate,"DD/MM/YYYY")})},{name:"Chức năng",selector:s=>e.jsxs(e.Fragment,{children:[e.jsx(d,{type:"button",className:"btn btn-warning white mr-10",onClick:()=>E(s),children:"Sửa"}),e.jsx(d,{type:"button",className:"btn btn-danger white",onClick:()=>R(s),children:"Xoá"})]})}],[U,E]),q=()=>{k(M)},G=async s=>{s.preventDefault();const{id:a,...p}=r,c=(a?$:$.extend({password:m().min(6,"Mật khẩu tối thiểu 6 ký tự")})).safeParse(p);if(!c.success){const l={};c.error.issues.forEach(H=>{const D=H.path[0];D&&!l[D]&&(l[D]=H.message)}),N(l);return}N({});try{const l={...c.data};l.password||delete l.password,r.id?(await Y({id:r.id,body:l}).unwrap(),j.success("Cập nhật thành công!")):(await w({body:l}).unwrap(),j.success("Thêm thành công!")),x(!1),q(),C()}catch{j.error("Có lỗi xảy ra")}},u=s=>{const{name:a,value:p}=s.target,F=a==="phone"?p.replace(/\D/g,"").slice(0,11):p;k(c=>({...c,[a]:F})),N(c=>({...c,[a]:void 0}))};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between mt-10 mbt-10",children:[e.jsx("h1",{className:"m-0",children:"Tài khoản"}),e.jsx("div",{children:e.jsx(d,{type:"button",className:"btn btn-primary",onClick:()=>{q(),T("Thêm tài khoản"),x(!0)},children:"Thêm tài khoản"})})]}),e.jsx(z,{autoClose:1e3}),e.jsx(Z,{title:"",columns:X,data:I,defaultSortFieldId:"title",pagination:!0,progressPending:i,responsive:!0,dense:!0,customStyles:ee}),e.jsx(n,{show:A,size:"lg",onHide:()=>{x(!1),N({})},backdrop:"static",children:e.jsxs("form",{noValidate:!0,onSubmit:G,children:[e.jsx(n.Header,{closeButton:!0,children:e.jsxs(n.Title,{children:[" ",O," "]})}),e.jsxs(n.Body,{children:[e.jsx("div",{className:"mb-3",children:e.jsx("small",{className:"text-danger",children:"* là giá trị bắt buộc"})}),e.jsxs("div",{className:"row g-4",children:[e.jsxs("div",{className:"form-group col-6 mb-3",children:[e.jsxs("label",{children:["Họ ",e.jsx("sup",{className:"sub_text text-danger",children:"*"})]}),e.jsx(y,{className:`form-control ${t.firstName?"is-invalid":""}`,name:"firstName",value:r.firstName,placeholder:"Nhập họ",onChange:u,required:!0}),e.jsx("div",{className:"invalid-feedback",children:t.firstName})]}),e.jsxs("div",{className:" form-group col-6 mb-3",children:[e.jsxs("label",{children:["Tên ",e.jsx("sup",{className:"sub_text text-danger",children:"*"})]}),e.jsx(y,{className:`form-control ${t.lastName?"is-invalid":""}`,name:"lastName",placeholder:"Nhập tên",value:r.lastName,onChange:u,required:!0}),e.jsx("div",{className:"invalid-feedback",children:t.lastName})]})]}),e.jsxs("div",{className:"row g-4",children:[e.jsxs("div",{className:" form-group col-6 mb-3",children:[e.jsxs("label",{children:["Mật khẩu ",e.jsx("sup",{className:"sub_text text-danger",children:"*"})]}),e.jsxs("div",{className:"input-group",children:[e.jsx(B.Control,{className:`form-control ${t.password?"is-invalid":""}`,type:b?"text":"password",name:"password",placeholder:"Nhập mật khẩu",value:r.password,onChange:u,required:!r.id}),e.jsx("div",{className:"input-group-append",children:e.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>S(s=>!s),"aria-label":b?"Ẩn mật khẩu":"Hiện mật khẩu",children:e.jsx("img",{src:b?L.icNoEye:L.icEye,alt:b?"Hide":"Show",style:{width:20,height:20}})})})]}),e.jsx("div",{className:`invalid-feedback ${t.password?"d-block":""}`,children:t.password})]}),e.jsxs("div",{className:" form-group col-6 mb-3",children:[e.jsxs("label",{children:["Số điện thoại ",e.jsx("sup",{className:"sub_text text-danger",children:"*"})]}),e.jsx(y,{className:`form-control ${t.phone?"is-invalid":""}`,type:"tel",name:"phone",placeholder:"Nhập thông tin số thoại điện",value:r.phone,onChange:u,onPaste:s=>{const a=s.clipboardData.getData("text");/\D/.test(a)&&s.preventDefault()},inputMode:"numeric",maxLength:11,required:!0}),e.jsx("div",{className:"invalid-feedback",children:t.phone})]})]}),e.jsxs("div",{className:"row g-4",children:[e.jsxs("div",{className:" form-group col-6 mb-3",children:[e.jsxs("label",{children:["Email ",e.jsx("sup",{className:"sub_text text-danger",children:"*"})]}),e.jsx(y,{className:`form-control ${t.email?"is-invalid":""}`,type:"email",placeholder:"Nhập thông tin email",name:"email",value:r.email,onChange:u,required:!0}),e.jsx("div",{className:"invalid-feedback",children:t.email})]}),e.jsxs("div",{className:" form-group col-6 mb-3",children:[e.jsxs("label",{children:["Chức vụ ",e.jsx("sup",{className:"sub_text text-danger",children:"*"})]}),e.jsxs(B.Control,{as:"select",onChange:u,value:r.role,name:"role",required:!0,className:`${t.role?"is-invalid":""}`,children:[e.jsx("option",{value:"",disabled:!0,children:"Chức vụ"}),K.map((s,a)=>e.jsx("option",{value:s.name,children:s.name},a))]}),e.jsx("div",{className:"invalid-feedback",children:t.role})]})]})]}),e.jsxs(n.Footer,{children:[e.jsx(d,{variant:"secondary",type:"button",onClick:()=>{x(!1)},children:"Đóng"}),e.jsx(d,{variant:"primary",type:"submit",children:"Lưu"})]})]})}),e.jsxs(n,{show:f.show,onHide:()=>g({show:!1,id:null,label:""}),centered:!0,backdrop:"static",children:[e.jsx(n.Header,{closeButton:!0,children:e.jsx(n.Title,{children:"Xác nhận xoá"})}),e.jsxs(n.Body,{children:['Bạn có chắc muốn xoá tài khoản "',f.label,'" không?']}),e.jsxs(n.Footer,{children:[e.jsx(d,{variant:"secondary",type:"button",onClick:()=>g({show:!1,id:null,label:""}),children:"Huỷ"}),e.jsx(d,{variant:"danger",type:"button",onClick:async()=>{f.id&&(await U(f.id),g({show:!1,id:null,label:""}))},children:"Xoá"})]})]})]})},de={title:`Tài khoản - ${W.appName}`};function ve(){return e.jsxs(e.Fragment,{children:[e.jsx(J,{children:e.jsxs("title",{children:[" ",de.title]})}),e.jsx(ce,{})]})}export{ve as default};
