import{j as e,I as f,a as $,Q as z,B as E,c as m,p as Q,f as J,n as K,o as W,t as Y,v as Z}from"./index-Cisqq87o.js";import{r as u,L as ee}from"./vendor-D10guwLI.js";import{f as I}from"./format-number-DeezL_hy.js";import{C as N}from"./index-8_4KzXG3.js";import{u as te}from"./orders-BB7hcgcg.js";import{f as ae,i as se,v as ne}from"./format-string-Cee-rHUc.js";import{b as ce}from"./index-BDLNoMlA.js";import{M as p}from"./Modal-BE1P8Ww6.js";function M(t,n){try{if(typeof window>"u"||!window.localStorage)return n??null;const i=window.localStorage.getItem(t);return i!==null?i:n??null}catch{return null}}function le(t){var l;const{item:n,onDeleteItem:i,subItem:g,plusItem:y}=t;return e.jsxs("div",{className:"cart_item",children:[e.jsxs("div",{className:"cart_thumb",children:[e.jsx("button",{type:"button",className:"cart_delete",onClick:()=>i(),children:e.jsx("img",{src:f.delete,alt:"delete"})}),e.jsx(ce.LazyLoadImage,{effect:"blur",src:n.product.image||f.logo,placeholderSrc:f.logo,alt:n.product.name,onError:o=>{o!=null&&o.target&&(o.target.src=f.logo)}})]}),e.jsx("div",{className:"content_item",children:e.jsxs("div",{className:"mota",children:[e.jsx("p",{className:"title_item_cart",children:n.product.name}),e.jsxs("p",{className:"cart_price",children:[I(((l=n==null?void 0:n.product)==null?void 0:l.price)||0)," đ"]}),e.jsx("p",{className:"title_item_cart description__cart",children:ae(n.product.description)})]})}),e.jsxs("div",{className:"cart_qty",children:[e.jsx("button",{type:"button",className:"qty_btn",onClick:()=>g(),"aria-label":"Giảm",children:"−"}),e.jsx("div",{className:"quantity","aria-live":"polite",children:n.quantity}),e.jsx("button",{type:"button",className:"qty_btn",onClick:()=>y(),"aria-label":"Tăng",children:"+"})]})]})}function re(t){var D,k,L,S,q;const n=$(),[i,{isLoading:g}]=te(),[y,l]=u.useState(!1),[o,b]=u.useState("container-fluid"),[C,v]=u.useState({show:!1,id:null}),[d,P]=u.useState({firstName:"",lastName:"",phone:"",email:"",address:"",note:""});u.useEffect(()=>{M("token")||b("container"),l(!0)},[]);const w=(a,s,c)=>{if(c===-1&&a<=1||c===1&&a>=100)return;const{actUpdateItem:r}=t;r(s,c),m.success("Cập nhật thành công!")},h=(t==null?void 0:t.cartItem)??[],G=u.useMemo(()=>!Array.isArray(h)||h.length===0?null:h.map((a,s)=>{var r;const c=Number(a.quantity)||0;return e.jsx(le,{item:a,onDeleteItem:()=>v({show:!0,id:a.product.id}),subItem:()=>w(c,a.product.id,-1),plusItem:()=>w(c,a.product.id,1)},`${String((r=a.product)==null?void 0:r.id)}-${s}`)}),[h]),T=a=>{const{actDeleteItem:s}=t;s(a),m.success("Cập nhật thành công!"),M("token")||(l(!1),b("container"))},H=u.useMemo(()=>h.reduce((a,s)=>{var c;return a+(Number((c=s==null?void 0:s.product)==null?void 0:c.price)||0)*(Number(s==null?void 0:s.quantity)||0)},0),[h]),x=a=>{a.preventDefault();const{target:s}=a,{name:c,value:r}=s;P(_=>({..._,[c]:r}))},O=async()=>{const{firstName:a,lastName:s,email:c,address:r,phone:_,note:A}=d,{cartItem:U}=t,B=new Date;if(a===""||s===""||c===""||r===""||_===""){m.warning("Vui lòng nhập đủ thông tin của bạn!");return}if(!se(c)){m.error("Nhập đúng định dạng email!");return}if(!ne(_)){m.error("Số điện thoại phải có 10-11 chữ số!");return}const V=(U||[]).map(j=>({productId:j.product.id,quantity:j.quantity,unitPrice:j.product.price,subtotal:j.product.price*j.quantity,discount:0,note:A}));try{await i({body:{data:B,expectDateDelivery:B,note:A,customer:{firstName:a,lastName:s,phone:_,email:c,address:r},lines:V}}).unwrap(),t==null||t.actDeleteAll(),l(!1),b("container"),n.push(Q.main.successPayment)}catch{m.error("Có lỗi xảy ra")}},X=()=>{t==null||t.actDeleteAll(),l(!1),b("container"),m.success("Thành công!")},F=e.jsx("div",{className:"description_cart",children:e.jsxs("div",{className:"page_empty",children:[e.jsx("img",{className:"img_empty_cart",alt:"empty",src:f.empty}),e.jsx(ee,{to:"/",className:"btn_back",children:e.jsx("span",{children:"Mua thêm sản phẩm"})})]})}),R=y===!0&&e.jsxs("div",{className:"cart_custom",children:[e.jsx("div",{className:"cart_header_custom",children:e.jsx("p",{className:"content_cart",children:"Đơn hàng"})}),e.jsx("div",{className:"cart_custom_body",children:e.jsxs("div",{className:"cart_custom_detail",children:[e.jsx(N,{className:"input_custom",style:{marginLeft:20,width:"90%"},onChange:x,name:"firstName",value:d.firstName,placeholder:"Nhập họ"}),e.jsx("br",{}),e.jsx(N,{className:"input_custom",style:{marginLeft:20,width:"90%"},onChange:x,name:"lastName",value:d.lastName,placeholder:"Nhập tên"}),e.jsx("br",{}),e.jsx(N,{className:"input_custom",placeholder:"Nhập địa chỉ",style:{marginLeft:20,width:"90%"},name:"address",value:d.address,onChange:x}),e.jsx("br",{}),e.jsx(N,{className:"input_custom",style:{marginLeft:20,width:"90%"},placeholder:"Nhập số điện thoại",name:"phone",type:"tel",value:d.phone,onChange:x}),e.jsx("br",{}),e.jsx(N,{className:"input_custom",style:{marginLeft:20,width:"90%"},placeholder:"Nhập email",value:d.email,name:"email",type:"email",onChange:x}),e.jsx(N,{className:"input_custom",style:{marginLeft:20,width:"90%"},placeholder:"Nhập ghi chú nếu có",value:d.note,name:"note",onChange:x})]})}),e.jsxs("div",{className:"cart_amount_body",children:[e.jsxs("div",{className:"thongtin",children:[e.jsx("p",{children:"Giá sản phẩm (1):"}),e.jsx("p",{children:"Tổng cộng:"})]}),e.jsxs("div",{className:"thanhtoan",children:[e.jsxs("p",{children:[I(((L=(k=(D=t==null?void 0:t.cartItem)==null?void 0:D[0])==null?void 0:k.product)==null?void 0:L.price)||0)," đ"]}),e.jsxs("p",{className:"total",children:[I(H)," đ"]})]})]}),e.jsx("button",{type:"button",className:"btn_payment",onClick:O,disabled:g,children:"Đặt mua"})]});return e.jsxs("div",{className:o,children:[e.jsx(z,{autoClose:1e3}),e.jsxs("div",{className:"page_cart",children:[e.jsxs("div",{className:"card_cart",children:[e.jsxs("div",{className:"cart_header",children:[e.jsx("p",{className:"content_cart",children:"Giỏ hàng"}),e.jsxs("p",{className:"number_cart",children:[(t==null?void 0:t.cartItem.length)??0," sản phẩm"]})]}),e.jsxs("div",{className:"cart_body",children:[e.jsxs("div",{className:"option",children:[e.jsxs("div",{className:"select_all",children:[e.jsx("input",{type:"checkbox",className:"checkbox"}),e.jsx("p",{className:"text_selectAll",style:{paddingLeft:8},children:"Chọn tất cả"})]}),(((S=t==null?void 0:t.cartItem)==null?void 0:S.length)??0)>0&&e.jsxs("button",{type:"button",className:"delete_item",onClick:X,children:[e.jsx("img",{src:f.delete,alt:"delete"}),e.jsx("p",{className:"text_delete",children:"Xoá tất cả"})]})]}),e.jsx("div",{className:"content_cart_item",children:(q=t==null?void 0:t.cartItem)!=null&&q.length?G:F})]})]}),R,e.jsxs(p,{centered:!0,show:C.show,onHide:()=>v({show:!1,id:null}),children:[e.jsx(p.Header,{closeButton:!0,children:e.jsx(p.Title,{children:"Xác nhận"})}),e.jsx(p.Body,{children:"Bạn muốn xoá sản phẩm này?"}),e.jsxs(p.Footer,{children:[e.jsx(E,{variant:"secondary",onClick:()=>v({show:!1,id:null}),children:"Huỷ"}),e.jsx(E,{variant:"danger",onClick:()=>{C.id!==null&&T(C.id),v({show:!1,id:null})},children:"Xoá"})]})]})]})]})}function Ne(){const t=J(),n=K(l=>l.cart),i=(l,o)=>{t(W({id:l,quantities:o}))},g=l=>{t(Y({id:l}))},y=()=>{t(Z())};return e.jsx(re,{cartItem:n,actUpdateItem:i,actDeleteItem:g,actDeleteAll:y})}export{Ne as default};
