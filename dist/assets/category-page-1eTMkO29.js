import{j as e,B as n,Q as X,I as $,c,H as P,d as V}from"./index-Cisqq87o.js";import{f as D}from"./format-time-Di1EMY9f.js";import{r}from"./vendor-D10guwLI.js";import{e as _}from"./index.es-3P-hqikk.js";import{u as q,a as G,b as Q,c as A}from"./category-DF8oV3zg.js";import{M as s}from"./Modal-BE1P8Ww6.js";import{F as O}from"./Form-B4CIVEzx.js";import{o as U,s as z}from"./types-BvcOK83k.js";import"./dayjs.min-DmYrFLVn.js";const J=()=>{const{data:M=[],isLoading:N,refetch:f}=q(),[k]=G(),[F]=Q(),[S]=A(),[T,i]=r.useState(!1),[B,j]=r.useState(""),[d,m]=r.useState({show:!1,id:null,label:""}),x={id:null,name:""},[h,l]=r.useState(x),[g,o]=r.useState({}),Y=U({name:z().min(1,"Vui lòng nhập tên danh mục!")}),y=t=>{l({id:t.id,name:t.name}),j("Cập nhật danh mục"),i(!0)},H=t=>{const a=t.name||`#${t.id}`;m({show:!0,id:t.id,label:a})},w=async t=>{try{await S({id:t}).unwrap(),c.success("Xóa thành công"),await f()}catch{c.error("Có lỗi xảy ra")}},C=()=>{l(x),o({})},E=async t=>{t.preventDefault();const{id:a,...L}=h,u=Y.safeParse(L);if(!u.success){const p={};u.error.issues.forEach(v=>{const b=v.path[0];b&&!p[b]&&(p[b]=v.message)}),o(p);return}o({});try{a?(await F({id:a,body:u.data}).unwrap(),c.success("Cập nhật thành công!")):(await k({body:u.data}).unwrap(),c.success("Thêm thành công!")),await f(),i(!1),C()}catch{c.error("Có lỗi xảy ra")}},R=r.useMemo(()=>[{name:"#",selector:"id",sortable:!0},{name:"Tên danh mục",selector:"name",sortable:!0},{name:"Ngày tạo",selector:"createDate",sortable:!0,right:!0,cell:t=>e.jsx("span",{children:D(t.createDate,"DD/MM/YYYY")})},{name:"Ngày chỉnh sửa",selector:"writeDate",sortable:!0,right:!0,cell:t=>e.jsx("span",{children:D(t.writeDate,"DD/MM/YYYY")})},{name:"Chức năng",selector:(t,a)=>e.jsxs(e.Fragment,{children:[e.jsx(n,{type:"button",className:"btn btn-warning white mr-10",onClick:()=>y(t),children:"Sửa"}),e.jsx(n,{type:"button",className:"btn btn-danger white",onClick:()=>H(t),children:"Xoá"})]})}],[w,y]),I=r.useMemo(()=>({rows:{style:{minHeight:"42px"}},headCells:{style:{paddingTop:"6px",paddingBottom:"6px",paddingLeft:"12px",paddingRight:"12px"}},cells:{style:{paddingTop:"6px",paddingBottom:"6px",paddingLeft:"12px",paddingRight:"12px"}}}),[]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between mt-10 mbt-10",children:[e.jsx("h1",{className:"m-0",children:"Danh sách danh mục"}),e.jsx("div",{children:e.jsx(n,{type:"button",className:"btn btn-primary",onClick:()=>{i(!0),j("Thêm danh mục"),l(x),o({})},children:"Thêm danh mục"})})]}),e.jsx(X,{autoClose:1e3}),e.jsx(_,{title:"",columns:R,data:M,defaultSortFieldId:"title",pagination:!0,progressPending:N,responsive:!0,dense:!0,customStyles:I}),e.jsx(s,{show:T,onHide:()=>{i(!1)},backdrop:"static",children:e.jsxs("form",{onSubmit:E,noValidate:!0,children:[e.jsx(s.Header,{closeButton:!0,children:e.jsxs(s.Title,{children:[" ",B," "]})}),e.jsxs(s.Body,{children:[e.jsxs("label",{children:["Tên danh mục ",e.jsx("sup",{className:"sub_text text-danger",children:"*"})]}),e.jsxs("div",{className:"position-relative",children:[e.jsx(O.Control,{className:`form-control ${g.name?"is-invalid":""}`,name:"name",value:h.name,onChange:t=>{l(a=>({...a,name:t.target.value})),o(a=>({...a,name:void 0}))},required:!0,style:{paddingRight:h.name?"2.25rem":void 0}}),h.name?e.jsx(n,{variant:"link",className:"position-absolute border-0 bg-transparent p-0",style:{right:"0.5rem",top:"50%",transform:"translateY(-50%)"},"aria-label":"Clear",onClick:()=>{l(t=>({...t,name:""})),o(t=>({...t,name:void 0}))},children:e.jsx("img",{src:$.ic_clear,alt:"clear",width:16,height:16})}):null]}),e.jsx("div",{className:`invalid-feedback ${g.name?"d-block":""}`,children:g.name})]}),e.jsxs(s.Footer,{children:[e.jsx(n,{variant:"secondary",type:"button",onClick:()=>{i(!1),C()},children:"Đóng"}),e.jsx(n,{variant:"primary",type:"submit",children:"Lưu"})]})]})}),e.jsxs(s,{show:d.show,onHide:()=>m({show:!1,id:null,label:""}),centered:!0,backdrop:"static",children:[e.jsx(s.Header,{closeButton:!0,children:e.jsx(s.Title,{children:"Xác nhận xoá"})}),e.jsxs(s.Body,{children:['Bạn có chắc muốn xoá danh mục "',d.label,'" không?']}),e.jsxs(s.Footer,{children:[e.jsx(n,{variant:"secondary",type:"button",onClick:()=>m({show:!1,id:null,label:""}),children:"Huỷ"}),e.jsx(n,{variant:"danger",type:"button",onClick:async()=>{d.id&&(await w(d.id),m({show:!1,id:null,label:""}))},children:"Xoá"})]})]})]})},K={title:`Danh mục - ${V.appName}`};function ie(){return e.jsxs(e.Fragment,{children:[e.jsx(P,{children:e.jsxs("title",{children:[" ",K.title]})}),e.jsx(J,{})]})}export{ie as default};
