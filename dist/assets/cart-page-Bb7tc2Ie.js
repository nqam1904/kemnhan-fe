import{r as l,j as e,z as I,Q as O,M as u,s as k,v as x,L as Q,e as W,l as J}from"./vendor-react-D439mYZB.js";import{C as g}from"./index-Cno6cLFA.js";import{I as h,a as K,p as Y,g as Z,h as ee,i as se}from"./index-CCO37Pg2.js";import{u as te}from"./orders-CgAxjZou.js";import{f as b}from"./format-number-D7I21mwK.js";import{f as ae,i as ne,v as re}from"./format-string-Cee-rHUc.js";import"./vendor-misc-BkUckcGj.js";import"./vendor-redux-CY9rYXZh.js";import"./vendor-ui-qtF25uBn.js";import"./vendor-utils-DifT8CeW.js";const le={xs:0,sm:576,md:768,lg:992,xl:1200,xxl:1400},ie=typeof window<"u"?l.useLayoutEffect:l.useEffect;function E(a){const s=l.useMemo(()=>({...le,...a}),[a]),[i,d]=l.useState(()=>typeof window<"u"?{width:window.innerWidth,height:window.innerHeight}:{width:0,height:0});ie(()=>{const t=()=>{d({width:window.innerWidth,height:window.innerHeight})};return window.addEventListener("resize",t),t(),()=>{window.removeEventListener("resize",t)}},[]);const m=l.useMemo(()=>{const{width:t}=i;return{isMobile:t<s.md,isTablet:t>=s.md&&t<s.lg,isDesktop:t>=s.lg,isXs:t>=s.xs&&t<s.sm,isSm:t>=s.sm&&t<s.md,isMd:t>=s.md&&t<s.lg,isLg:t>=s.lg&&t<s.xl,isXl:t>=s.xl&&t<s.xxl,isXxl:t>=s.xxl,isSmUp:t>=s.sm,isMdUp:t>=s.md,isLgUp:t>=s.lg,isXlUp:t>=s.xl,isSmDown:t<s.sm,isMdDown:t<s.md,isLgDown:t<s.lg,isXlDown:t<s.xl}},[i,s]);return l.useMemo(()=>({...i,...m,breakpoints:s}),[i,m,s])}function ce(a){const{item:s,onDeleteItem:i,subItem:d,plusItem:m}=a;return e.jsxs("div",{className:"cart_item_desktop",children:[e.jsxs("div",{className:"cart_thumb",children:[e.jsx("div",{className:"cart_delete",children:e.jsx("img",{src:h.delete,alt:"delete",onClick:i})}),e.jsx(I.LazyLoadImage,{effect:"blur",className:"cart_product_img",src:s.product.image||h.logo,placeholderSrc:h.logo,alt:s.product.name,onError:r=>{r?.target&&(r.target.src=h.logo)}})]}),e.jsx("div",{className:"content_item",children:e.jsxs("div",{className:"mota",children:[e.jsx("p",{className:"title_item_cart",children:s.product.name}),e.jsxs("p",{className:"cart_price",children:[b(s.product.price||0)," đ"]}),e.jsx("p",{className:"title_item_cart description__cart",children:ae(s.product.description)})]})}),e.jsxs("div",{className:"cart_qty",children:[e.jsx("button",{type:"button",className:"qty_btn",onClick:()=>d(),"aria-label":"Giảm",children:"−"}),e.jsx("div",{className:"quantity","aria-live":"polite",children:s.quantity}),e.jsx("button",{type:"button",className:"qty_btn",onClick:()=>m(),"aria-label":"Tăng",children:"+"})]})]})}function oe(a){const{item:s,onDeleteItem:i,subItem:d,plusItem:m}=a;return e.jsxs("div",{className:"cart_item_mobile",children:[e.jsxs("div",{className:"cart_thumb_mobile",children:[e.jsx("div",{className:"cart_delete",children:e.jsx("img",{src:h.delete,alt:"delete",onClick:i})}),e.jsx(I.LazyLoadImage,{effect:"blur",className:"cart_product_img",src:s.product.image||h.logo,placeholderSrc:h.logo,alt:s.product.name,onError:r=>{r?.target&&(r.target.src=h.logo)}})]}),e.jsxs("div",{className:"content_item_mobile",children:[e.jsx("p",{className:"title_item_cart",children:s.product.name}),e.jsxs("p",{className:"cart_price",children:[b(s.product.price||0)," đ"]})]}),e.jsxs("div",{className:"cart_qty_mobile",children:[e.jsx("button",{type:"button",className:"qty_btn",onClick:()=>d(),"aria-label":"Giảm",children:"−"}),e.jsx("div",{className:"quantity","aria-live":"polite",children:s.quantity}),e.jsx("button",{type:"button",className:"qty_btn",onClick:()=>m(),"aria-label":"Tăng",children:"+"})]})]})}function de(a){const{isMobile:s}=E();return s?e.jsx(oe,{...a}):e.jsx(ce,{...a})}function me({cartItem:a=[],actUpdateItem:s,actDeleteItem:i,actDeleteAll:d}){const m=K(),{isDesktop:r}=E(),[t,{isLoading:z}]=te(),[A,_]=l.useState(!1),[X,v]=l.useState("container-fluid"),[q,y]=l.useState({show:!1,id:null}),[H,w]=l.useState(!1),[p,T]=l.useState({firstName:"",lastName:"",phone:"",email:"",address:"",note:""});l.useEffect(()=>{v("container"),a.length>0&&_(!0)},[a]);const D=(n,o,c)=>{c===-1&&n<=1||c===1&&n>=100||(s(o,c),x.success("Cập nhật thành công!"))},B=l.useMemo(()=>!Array.isArray(a)||a.length===0?null:a.map((n,o)=>{const c=Number(n.quantity)||0;return e.jsx(de,{item:n,onDeleteItem:()=>y({show:!0,id:n.product.id}),subItem:()=>D(c,n.product.id,-1),plusItem:()=>D(c,n.product.id,1)},`${String(n.product?.id)}-${o}`)}),[a]),F=n=>{i(n),x.success("Cập nhật thành công!"),_(!1),v("container")},S=l.useMemo(()=>a.reduce((n,o)=>n+(Number(o?.product?.price)||0)*(Number(o?.quantity)||0),0),[a]),j=n=>{n.preventDefault();const{target:o}=n,{name:c,value:C}=o;T(f=>({...f,[c]:C}))},P=async()=>{const{firstName:n,lastName:o,email:c,address:C,phone:f,note:L}=p,M=new Date;if(n===""||o===""||c===""||C===""||f===""){x.warning("Vui lòng nhập đủ thông tin của bạn!");return}if(!ne(c)){x.error("Nhập đúng định dạng email!");return}if(!re(f)){x.error("Số điện thoại phải có 10-11 chữ số!");return}const R=15e3,$=(a||[]).map(N=>({productId:N.product.id,quantity:N.quantity,unitPrice:N.product.price,subtotal:N.product.price*N.quantity,discount:0,note:L}));try{await t({body:{data:M,expectDateDelivery:M,note:L,shippingFee:R,customer:{firstName:n,lastName:o,phone:f,email:c,address:C},lines:$}}).unwrap(),d(),_(!1),v("container"),m.push(Y.main.successPayment)}catch{x.error("Có lỗi xảy ra")}},U=()=>{d(),_(!1),v("container"),x.success("Thành công!")},V=e.jsx("div",{className:"description_cart",children:e.jsxs("div",{className:`page_empty ${r?"page_empty_desktop":"page_empty_mobile"}`,children:[e.jsx("img",{className:"img_empty_cart",alt:"empty",src:h.empty}),e.jsx(Q,{to:"/",className:`btn_back ${r?"btn_back_desktop":"btn_back_mobile"}`,children:e.jsx("span",{children:"Mua thêm sản phẩm"})})]})}),G=A?e.jsxs("div",{className:"cart_custom",children:[e.jsx("div",{className:"cart_header_custom",children:e.jsx("p",{className:"content_cart",children:"Đơn hàng"})}),e.jsx("div",{className:"cart_custom_body",children:e.jsxs("div",{className:"cart_custom_detail",children:[e.jsxs("div",{className:"form-group mb-3",children:[e.jsxs("label",{children:["Họ ",e.jsx("sup",{className:"text-danger",children:"*"})]}),e.jsx(g,{className:"form-control",onChange:j,name:"firstName",value:p.firstName,placeholder:"Nhập họ",required:!0})]}),e.jsxs("div",{className:"form-group mb-3",children:[e.jsxs("label",{children:["Tên ",e.jsx("sup",{className:"text-danger",children:"*"})]}),e.jsx(g,{className:"form-control",onChange:j,name:"lastName",value:p.lastName,placeholder:"Nhập tên",required:!0})]}),e.jsxs("div",{className:"form-group mb-3",children:[e.jsxs("label",{children:["Địa chỉ ",e.jsx("sup",{className:"text-danger",children:"*"})]}),e.jsx(g,{className:"form-control",placeholder:"Nhập địa chỉ",name:"address",value:p.address,onChange:j,required:!0})]}),e.jsxs("div",{className:"form-group mb-3",children:[e.jsxs("label",{children:["Số điện thoại ",e.jsx("sup",{className:"text-danger",children:"*"})]}),e.jsx(g,{className:"form-control",placeholder:"Nhập số điện thoại",name:"phone",type:"tel",value:p.phone,onChange:j,inputMode:"numeric",maxLength:11,required:!0})]}),e.jsxs("div",{className:"form-group mb-3",children:[e.jsxs("label",{children:["Email ",e.jsx("sup",{className:"text-danger",children:"*"})]}),e.jsx(g,{className:"form-control",placeholder:"Nhập email",value:p.email,name:"email",type:"email",onChange:j,required:!0})]}),e.jsxs("div",{className:"form-group mb-3",children:[e.jsx("label",{children:"Ghi chú"}),e.jsx(g,{className:"form-control",placeholder:"Nhập ghi chú nếu có",value:p.note,name:"note",onChange:j})]})]})}),e.jsx("div",{className:"cart_amount_body",children:e.jsxs("div",{className:"order-summary",children:[e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{children:"Tạm tính:"}),e.jsxs("span",{children:[b(S)," đ"]})]}),e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{children:"Phí vận chuyển:"}),e.jsxs("span",{children:[b(15e3)," đ"]})]}),e.jsxs("div",{className:"summary-row total-row",children:[e.jsx("span",{children:e.jsx("strong",{children:"Tổng cộng:"})}),e.jsx("span",{className:"total",children:e.jsxs("strong",{children:[b(S+15e3)," đ"]})})]})]})}),e.jsx("button",{type:"button",className:"btn_payment",onClick:P,disabled:z,children:"Đặt mua"})]}):null;return e.jsxs("div",{className:X,children:[e.jsx(O,{autoClose:1e3}),e.jsxs("div",{className:"page_cart",children:[e.jsxs("div",{className:"card_cart",children:[e.jsxs("div",{className:"cart_header",children:[e.jsx("p",{className:"content_cart",children:"Giỏ hàng"}),e.jsxs("p",{className:"number_cart",children:[a.length??0," sản phẩm"]})]}),e.jsxs("div",{className:"cart_body",children:[e.jsxs("div",{className:"option",children:[e.jsxs("div",{className:"select_all",children:[e.jsx("input",{type:"checkbox",className:"checkbox"}),e.jsx("p",{className:"text_selectAll",style:{paddingLeft:8},children:"Chọn tất cả"})]}),(a?.length??0)>0&&e.jsxs("button",{type:"button",className:"delete_item",onClick:()=>w(!0),children:[e.jsx("img",{src:h.delete,alt:"delete"}),e.jsx("p",{className:"text_delete",children:"Xoá tất cả"})]})]}),e.jsx("div",{className:"content_cart_item",children:a?.length?B:V})]})]}),G,e.jsxs(u,{centered:!0,show:q.show,onHide:()=>y({show:!1,id:null}),children:[e.jsx(u.Header,{closeButton:!0,children:e.jsx(u.Title,{children:"Xác nhận"})}),e.jsx(u.Body,{children:"Bạn muốn xoá sản phẩm này?"}),e.jsxs(u.Footer,{children:[e.jsx(k,{variant:"secondary",onClick:()=>y({show:!1,id:null}),children:"Huỷ"}),e.jsx(k,{variant:"danger",onClick:()=>{q.id!==null&&F(q.id),y({show:!1,id:null})},children:"Xoá"})]})]}),e.jsxs(u,{centered:!0,show:H,onHide:()=>w(!1),children:[e.jsx(u.Header,{closeButton:!0,children:e.jsx(u.Title,{children:"Xác nhận"})}),e.jsx(u.Body,{children:"Bạn có muốn xóa tất cả sản phẩm không?"}),e.jsxs(u.Footer,{children:[e.jsx(k,{variant:"secondary",onClick:()=>w(!1),children:"Huỷ"}),e.jsx(k,{variant:"danger",onClick:()=>{U(),w(!1)},children:"Xóa tất cả"})]})]})]})]})}function ve(){const a=W(),s=J(r=>r.cart),i=(r,t)=>{a(Z({id:r,quantities:t}))},d=r=>{a(ee({id:r}))},m=()=>{a(se())};return e.jsx(me,{cartItem:s,actUpdateItem:i,actDeleteItem:d,actDeleteAll:m})}export{ve as default};
