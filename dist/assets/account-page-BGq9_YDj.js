import{r as i,j as e,s as d,Q,X as z,M as r,F as L,v as j,w as K}from"./vendor-react-D439mYZB.js";import{R as J,e as v,I as P,j as W,C as Z}from"./index-CCO37Pg2.js";import{f as Y}from"./format-time-CqX4gBLH.js";import{C as y}from"./index-Cno6cLFA.js";import{c as ee}from"./styles-Bw6Lb06x.js";import{ao as se,ap as m,aq as te,ar as ae}from"./vendor-misc-BkUckcGj.js";import"./vendor-redux-CY9rYXZh.js";import"./vendor-ui-qtF25uBn.js";import"./vendor-utils-DifT8CeW.js";const ne=J.injectEndpoints({endpoints:h=>({getListUser:h.query({query:()=>({url:`${v.dashboard.account}`,method:"GET"})}),createUser:h.mutation({query:({body:o})=>({url:`${v.dashboard.account}`,method:"POST",body:o})}),updateUser:h.mutation({query:({id:o,body:w})=>({url:`${v.dashboard.account}/${o}`,method:"PUT",body:w})}),deleteUser:h.mutation({query:({id:o})=>({url:`${v.dashboard.account}/${o}`,method:"DELETE"})})})}),{useLazyGetListUserQuery:re,useCreateUserMutation:le,useUpdateUserMutation:ie,useDeleteUserMutation:oe}=ne,ce=()=>{const[h,{isLoading:o}]=re(),[w]=le(),[B]=ie(),[_]=oe(),[I,V]=i.useState([]),[X,x]=i.useState(!1),[A,T]=i.useState(""),[b,S]=i.useState(!1),[g,N]=i.useState({show:!1,id:null,label:""}),M={id:null,firstName:"",lastName:"",phone:"",password:"",email:"",role:""},[n,k]=i.useState(M),[t,f]=i.useState({}),$=se({firstName:m().min(1,"Vui lòng nhập họ"),lastName:m().min(1,"Vui lòng nhập tên"),phone:m().min(10,"Số điện thoại phải có 10-11 chữ số"),password:te([ae(""),m().min(6,"Mật khẩu tối thiểu 6 ký tự")]).optional(),email:m().email("Nhập đúng định dạng email"),role:m().min(1,"Vui lòng chọn chức vụ")}),C=async()=>{try{const s=await h().unwrap();V(s||[])}catch{}};i.useLayoutEffect(()=>{C()},[]);const E=s=>{k({id:s.id??null,firstName:s.firstName||"",lastName:s.lastName||"",phone:s.phone||"",password:"",email:s.email||"",role:s.role||""}),T("Sửa tài khoản"),S(!1),x(!0)},U=async s=>{try{await _({id:s}).unwrap(),j.success("Xóa thành công"),C()}catch(a){j.error(`${a}`)}},O=s=>{const p=`${s.firstName||""} ${s.lastName||""}`.trim()||s.email||`#${s.id}`;N({show:!0,id:s.id,label:p})},R=i.useMemo(()=>[{name:"#",selector:"id",sortable:!0},{name:"Họ",selector:"firstName",sortable:!0},{name:"Tên",selector:"lastName",sortable:!0},{name:"Số điện thoại",selector:"phone",sortable:!0,right:!0},{name:"Email",selector:"email",sortable:!0,right:!0},{name:"Chức vụ ",selector:"role",sortable:!0,right:!0},{name:"Ngày tạo",selector:"createDate",sortable:!0,right:!0,cell:s=>e.jsx("span",{children:Y(s.createDate,"DD/MM/YYYY")})},{name:"Ngày chỉnh sửa",selector:"writeDate",sortable:!0,right:!0,cell:s=>e.jsx("span",{children:Y(s.writeDate,"DD/MM/YYYY")})},{name:"Chức năng",selector:s=>e.jsxs(e.Fragment,{children:[e.jsx(d,{type:"button",className:"btn btn-warning white mr-10",onClick:()=>E(s),children:"Sửa"}),e.jsx(d,{type:"button",className:"btn btn-danger white",onClick:()=>O(s),children:"Xoá"})]})}],[U,E]),q=()=>{k(M)},G=async s=>{s.preventDefault();const{id:a,...p}=n,c=(a?$:$.extend({password:m().min(6,"Mật khẩu tối thiểu 6 ký tự")})).safeParse(p);if(!c.success){const l={};c.error.issues.forEach(H=>{const D=H.path[0];D&&!l[D]&&(l[D]=H.message)}),f(l);return}f({});try{const l={...c.data};l.password||delete l.password,n.id?(await B({id:n.id,body:l}).unwrap(),j.success("Cập nhật thành công!")):(await w({body:l}).unwrap(),j.success("Thêm thành công!")),x(!1),q(),C()}catch{j.error("Có lỗi xảy ra")}},u=s=>{const{name:a,value:p}=s.target,F=a==="phone"?p.replace(/\D/g,"").slice(0,11):p;k(c=>({...c,[a]:F})),f(c=>({...c,[a]:void 0}))};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between mt-10 mbt-10",children:[e.jsx("h1",{className:"m-0",children:"Tài khoản"}),e.jsx("div",{children:e.jsx(d,{type:"button",className:"btn btn-primary",onClick:()=>{q(),T("Thêm tài khoản"),x(!0)},children:"Thêm tài khoản"})})]}),e.jsx(Q,{autoClose:1e3}),e.jsx(z,{title:"",columns:R,data:I,defaultSortFieldId:"title",pagination:!0,progressPending:o,responsive:!0,dense:!0,customStyles:ee}),e.jsx(r,{show:X,size:"lg",onHide:()=>{x(!1),f({})},backdrop:"static",children:e.jsxs("form",{noValidate:!0,onSubmit:G,children:[e.jsx(r.Header,{closeButton:!0,children:e.jsxs(r.Title,{children:[" ",A," "]})}),e.jsxs(r.Body,{children:[e.jsx("div",{className:"mb-3",children:e.jsx("small",{className:"text-danger",children:"* là giá trị bắt buộc"})}),e.jsxs("div",{className:"row g-4",children:[e.jsxs("div",{className:"form-group col-6 mb-3",children:[e.jsxs("label",{children:["Họ ",e.jsx("sup",{className:"sub_text text-danger",children:"*"})]}),e.jsx(y,{className:`form-control ${t.firstName?"is-invalid":""}`,name:"firstName",value:n.firstName,placeholder:"Nhập họ",onChange:u,required:!0}),e.jsx("div",{className:"invalid-feedback",children:t.firstName})]}),e.jsxs("div",{className:" form-group col-6 mb-3",children:[e.jsxs("label",{children:["Tên ",e.jsx("sup",{className:"sub_text text-danger",children:"*"})]}),e.jsx(y,{className:`form-control ${t.lastName?"is-invalid":""}`,name:"lastName",placeholder:"Nhập tên",value:n.lastName,onChange:u,required:!0}),e.jsx("div",{className:"invalid-feedback",children:t.lastName})]})]}),e.jsxs("div",{className:"row g-4",children:[e.jsxs("div",{className:" form-group col-6 mb-3",children:[e.jsxs("label",{children:["Mật khẩu ",e.jsx("sup",{className:"sub_text text-danger",children:"*"})]}),e.jsxs("div",{className:"input-group",children:[e.jsx(L.Control,{className:`form-control ${t.password?"is-invalid":""}`,type:b?"text":"password",name:"password",placeholder:"Nhập mật khẩu",value:n.password,onChange:u,required:!n.id}),e.jsx("div",{className:"input-group-append",children:e.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>S(s=>!s),"aria-label":b?"Ẩn mật khẩu":"Hiện mật khẩu",children:e.jsx("img",{src:b?P.icNoEye:P.icEye,alt:b?"Hide":"Show",style:{width:20,height:20}})})})]}),e.jsx("div",{className:`invalid-feedback ${t.password?"d-block":""}`,children:t.password})]}),e.jsxs("div",{className:" form-group col-6 mb-3",children:[e.jsxs("label",{children:["Số điện thoại ",e.jsx("sup",{className:"sub_text text-danger",children:"*"})]}),e.jsx(y,{className:`form-control ${t.phone?"is-invalid":""}`,type:"tel",name:"phone",placeholder:"Nhập thông tin số thoại điện",value:n.phone,onChange:u,onPaste:s=>{const a=s.clipboardData.getData("text");/\D/.test(a)&&s.preventDefault()},inputMode:"numeric",maxLength:11,required:!0}),e.jsx("div",{className:"invalid-feedback",children:t.phone})]})]}),e.jsxs("div",{className:"row g-4",children:[e.jsxs("div",{className:" form-group col-6 mb-3",children:[e.jsxs("label",{children:["Email ",e.jsx("sup",{className:"sub_text text-danger",children:"*"})]}),e.jsx(y,{className:`form-control ${t.email?"is-invalid":""}`,type:"email",placeholder:"Nhập thông tin email",name:"email",value:n.email,onChange:u,required:!0}),e.jsx("div",{className:"invalid-feedback",children:t.email})]}),e.jsxs("div",{className:" form-group col-6 mb-3",children:[e.jsxs("label",{children:["Chức vụ ",e.jsx("sup",{className:"sub_text text-danger",children:"*"})]}),e.jsxs(L.Control,{as:"select",onChange:u,value:n.role,name:"role",required:!0,className:`${t.role?"is-invalid":""}`,children:[e.jsx("option",{value:"",disabled:!0,children:"Chức vụ"}),W.map((s,a)=>e.jsx("option",{value:s.name,children:s.name},a))]}),e.jsx("div",{className:"invalid-feedback",children:t.role})]})]})]}),e.jsxs(r.Footer,{children:[e.jsx(d,{variant:"secondary",type:"button",onClick:()=>{x(!1)},children:"Đóng"}),e.jsx(d,{variant:"primary",type:"submit",children:"Lưu"})]})]})}),e.jsxs(r,{show:g.show,onHide:()=>N({show:!1,id:null,label:""}),centered:!0,backdrop:"static",children:[e.jsx(r.Header,{closeButton:!0,children:e.jsx(r.Title,{children:"Xác nhận xoá"})}),e.jsxs(r.Body,{children:['Bạn có chắc muốn xoá tài khoản "',g.label,'" không?']}),e.jsxs(r.Footer,{children:[e.jsx(d,{variant:"secondary",type:"button",onClick:()=>N({show:!1,id:null,label:""}),children:"Huỷ"}),e.jsx(d,{variant:"danger",type:"button",onClick:async()=>{g.id&&(await U(g.id),N({show:!1,id:null,label:""}))},children:"Xoá"})]})]})]})},de={title:`Tài khoản - ${Z.appName}`};function fe(){return e.jsxs(e.Fragment,{children:[e.jsx(K,{children:e.jsxs("title",{children:[" ",de.title]})}),e.jsx(ce,{})]})}export{fe as default};
